<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="pgGit Documentation">
    <title>Architecture Overview - pgGit</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        .doc-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        .doc-content h1:first-child {
            margin-top: 0;
        }
        .toc {
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .toc h2 {
            margin-top: 0;
            font-size: 1.25rem;
        }
        .toc ul {
            list-style: none;
            padding-left: 1rem;
        }
        .toc li {
            margin: 0.5rem 0;
        }
        .breadcrumb {
            margin-bottom: 2rem;
            color: var(--text-light);
        }
        .breadcrumb a {
            color: var(--text-light);
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">pgGit</a>
            <ul>
                <li><a href="/#quick-start">Quick Start</a></li>
                <li><a href="/docs/">Documentation</a></li>
                <li><a href="/api/">API Reference</a></li>
                <li><a href="https://github.com/evoludigit/pggit">GitHub</a></li>
            </ul>
        </nav>
    </header>
    
    <main class="doc-content">
        <div class="breadcrumb">
            <a href="/">Home</a> / <a href="/docs/">Docs</a> / Architecture
Overview - pgGit
        </div>
        
                <div class="toc">
            <h2>Table of Contents</h2>
            <ul>
            <li><a
            href="#architecture-decision-single-extension-with-modular-design"
            id="toc-architecture-decision-single-extension-with-modular-design">Architecture
            Decision: Single Extension with Modular Design</a>
            <ul>
            <li><a
            href="#decision-enhanced-pg_gitversion-with-optional-sync-module"
            id="toc-decision-enhanced-pg_gitversion-with-optional-sync-module">Decision:
            Enhanced pg_gitversion with Optional Sync Module</a></li>
            <li><a href="#architecture-overview"
            id="toc-architecture-overview">Architecture
            Overview</a></li>
            <li><a href="#implementation-strategy"
            id="toc-implementation-strategy">Implementation Strategy</a>
            <ul>
            <li><a href="#modular-loading" id="toc-modular-loading">1.
            Modular Loading</a></li>
            <li><a href="#namespace-organization"
            id="toc-namespace-organization">2. Namespace
            Organization</a></li>
            <li><a href="#progressive-feature-disclosure"
            id="toc-progressive-feature-disclosure">3. Progressive
            Feature Disclosure</a></li>
            </ul></li>
            <li><a href="#benefits-of-this-approach"
            id="toc-benefits-of-this-approach">Benefits of This
            Approach</a>
            <ul>
            <li><a href="#unified-data-model"
            id="toc-unified-data-model">1. <strong>Unified Data
            Model</strong></a></li>
            <li><a href="#seamless-integration"
            id="toc-seamless-integration">2. <strong>Seamless
            Integration</strong></a></li>
            <li><a href="#performance-optimization"
            id="toc-performance-optimization">3. <strong>Performance
            Optimization</strong></a></li>
            <li><a href="#simplified-installation"
            id="toc-simplified-installation">4. <strong>Simplified
            Installation</strong></a></li>
            </ul></li>
            <li><a href="#module-design" id="toc-module-design">Module
            Design</a>
            <ul>
            <li><a href="#core-module-always-loaded"
            id="toc-core-module-always-loaded">Core Module (Always
            Loaded)</a></li>
            <li><a href="#sync-module-optional"
            id="toc-sync-module-optional">Sync Module
            (Optional)</a></li>
            <li><a href="#advanced-module-optional"
            id="toc-advanced-module-optional">Advanced Module
            (Optional)</a></li>
            </ul></li>
            <li><a href="#implementation-example"
            id="toc-implementation-example">Implementation Example</a>
            <ul>
            <li><a href="#enhanced-control-file"
            id="toc-enhanced-control-file">Enhanced Control
            File</a></li>
            <li><a href="#module-management"
            id="toc-module-management">Module Management</a></li>
            <li><a href="#usage-examples" id="toc-usage-examples">Usage
            Examples</a></li>
            </ul></li>
            <li><a href="#alternative-extension-family"
            id="toc-alternative-extension-family">Alternative: Extension
            Family</a></li>
            <li><a href="#decision-rationale"
            id="toc-decision-rationale">Decision Rationale</a></li>
            <li><a href="#conclusion"
            id="toc-conclusion">Conclusion</a></li>
            </ul></li>
            </ul>
        </div>
                
        <article class="markdown-body">
            <h1
            id="architecture-decision-single-extension-with-modular-design">Architecture
            Decision: Single Extension with Modular Design</h1>
            <h2
            id="decision-enhanced-pg_gitversion-with-optional-sync-module">Decision:
            Enhanced pg_gitversion with Optional Sync Module</h2>
            <p>After implementing DDL hashing, the synergies between
            versioning and schema synchronization are too significant to
            ignore. We recommend a <strong>single extension with modular
            components</strong>.</p>
            <h2 id="architecture-overview">Architecture Overview</h2>
            <pre><code>pg_gitversion
├── Core Module (always loaded)
│   ├── Event triggers &amp; tracking
│   ├── DDL hashing infrastructure  
│   ├── Version management
│   └── Local dependency tracking
├── Sync Module (optional)
│   ├── Remote database connections
│   ├── Cross-database comparison
│   ├── Conflict resolution
│   └── Bidirectional sync
└── Advanced Module (optional)
    ├── Multi-tenant support
    ├── Sharding utilities
    └── Blue-green deployment tools</code></pre>
            <h2 id="implementation-strategy">Implementation
            Strategy</h2>
            <h3 id="modular-loading">1. Modular Loading</h3>
            <div class="sourceCode" id="cb2"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Core extension (required)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> EXTENSION pg_gitversion;</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Optional modules</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> gitversion.enable_module(<span class="st">&#39;sync&#39;</span>);</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> gitversion.enable_module(<span class="st">&#39;advanced&#39;</span>);</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check enabled modules</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> gitversion.enabled_modules;</span></code></pre></div>
            <h3 id="namespace-organization">2. Namespace
            Organization</h3>
            <div class="sourceCode" id="cb3"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Core functions (always available)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>gitversion.get_version()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>gitversion.get_history()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>gitversion.compute_ddl_hash()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Sync functions (when module enabled)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>gitversion.sync_connect_remote()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>gitversion.sync_compare_schemas()</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>gitversion.sync_generate_migration()</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Advanced functions (when module enabled)</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>gitversion.advanced_multi_tenant_sync()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>gitversion.advanced_shard_consistency_check()</span></code></pre></div>
            <h3 id="progressive-feature-disclosure">3. Progressive
            Feature Disclosure</h3>
            <div class="sourceCode" id="cb4"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Level 1: Basic tracking (core)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (<span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>);</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> gitversion.get_version(<span class="st">&#39;public.users&#39;</span>);</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Level 2: Hash-based efficiency (core)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> gitversion.detect_changes_by_hash();</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Level 3: Cross-database sync (sync module)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> gitversion.sync_with_remote(<span class="st">&#39;prod_db&#39;</span>);</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Level 4: Advanced scenarios (advanced module)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> gitversion.advanced_tenant_sync(<span class="st">&#39;tenant_123&#39;</span>, <span class="st">&#39;template_schema&#39;</span>);</span></code></pre></div>
            <h2 id="benefits-of-this-approach">Benefits of This
            Approach</h2>
            <h3 id="unified-data-model">1. <strong>Unified Data
            Model</strong></h3>
            <ul>
            <li>Single source of truth for object tracking</li>
            <li>Shared hash infrastructure</li>
            <li>Consistent dependency modeling</li>
            <li>No data duplication between extensions</li>
            </ul>
            <h3 id="seamless-integration">2. <strong>Seamless
            Integration</strong></h3>
            <div class="sourceCode" id="cb5"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Version tracking feeds directly into sync</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> gitversion.sync_from_version(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    remote_db <span class="op">=&gt;</span> <span class="st">&#39;staging&#39;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    from_migration <span class="op">=&gt;</span> <span class="st">&#39;v1.2.0&#39;</span>,  <span class="co">-- From versioning system</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    to_migration <span class="op">=&gt;</span> <span class="st">&#39;v1.3.0&#39;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Sync respects local version history</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> gitversion.sync_with_conflict_resolution(</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    remote_db <span class="op">=&gt;</span> <span class="st">&#39;prod&#39;</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    strategy <span class="op">=&gt;</span> <span class="st">&#39;prefer_higher_version&#39;</span>  <span class="co">-- Uses version numbers</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>);</span></code></pre></div>
            <h3 id="performance-optimization">3. <strong>Performance
            Optimization</strong></h3>
            <div class="sourceCode" id="cb6"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Shared hash computation</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- No need to recompute hashes for sync operations</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span>.ddl_hash,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    remote.ddl_hash,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">local</span>.ddl_hash <span class="op">=</span> remote.ddl_hash <span class="kw">as</span> objects_match</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> gitversion.objects <span class="kw">local</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> gitversion.remote_objects(<span class="st">&#39;prod_db&#39;</span>) remote </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> <span class="kw">local</span>.full_name <span class="op">=</span> remote.full_name;</span></code></pre></div>
            <h3 id="simplified-installation">4. <strong>Simplified
            Installation</strong></h3>
            <div class="sourceCode" id="cb7"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Single extension handles everything</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> install</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-c</span> <span class="st">&quot;CREATE EXTENSION pg_gitversion&quot;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-c</span> <span class="st">&quot;SELECT gitversion.enable_module(&#39;sync&#39;)&quot;</span></span></code></pre></div>
            <h2 id="module-design">Module Design</h2>
            <h3 id="core-module-always-loaded">Core Module (Always
            Loaded)</h3>
            <p><strong>Files:</strong> -
            <code>pg_gitversion--1.1.0.sql</code> (enhanced with
            hashing) - <code>sql/001_schema.sql</code> -
            <code>sql/002_event_triggers.sql</code> -
            <code>sql/009_ddl_hashing.sql</code></p>
            <p><strong>Capabilities:</strong> - Event trigger-based
            tracking - DDL hashing infrastructure - Version management -
            Local dependency tracking - Migration generation</p>
            <h3 id="sync-module-optional">Sync Module (Optional)</h3>
            <p><strong>Files:</strong> -
            <code>sql/010_sync_module.sql</code></p>
            <p><strong>Capabilities:</strong></p>
            <div class="sourceCode" id="cb8"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Remote database management</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> gitversion.remote_databases (</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    name TEXT <span class="kw">UNIQUE</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    connection_string TEXT <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    enabled <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">true</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- Connection functions</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">FUNCTION</span> gitversion.sync_add_remote(name TEXT, connection TEXT);</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">FUNCTION</span> gitversion.sync_test_connection(remote_name TEXT);</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- Comparison functions  </span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">FUNCTION</span> gitversion.sync_compare_schemas(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    remote_name TEXT,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    local_schema TEXT <span class="kw">DEFAULT</span> <span class="st">&#39;public&#39;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>) RETURNS <span class="kw">TABLE</span>(<span class="op">..</span>.);</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">-- Sync functions</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">FUNCTION</span> gitversion.sync_generate_migration(</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    remote_name TEXT,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    direction TEXT <span class="co">-- &#39;to_remote&#39;, &#39;from_remote&#39;, &#39;bidirectional&#39;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>) RETURNS TEXT;</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">FUNCTION</span> gitversion.sync_apply_migration(</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    remote_name TEXT,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    migration_script TEXT,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    dry_run <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">true</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>) RETURNS <span class="kw">TABLE</span>(<span class="op">..</span>.);</span></code></pre></div>
            <h3 id="advanced-module-optional">Advanced Module
            (Optional)</h3>
            <p><strong>Files:</strong> -
            <code>sql/011_advanced_module.sql</code></p>
            <p><strong>Capabilities:</strong> - Multi-tenant schema
            synchronization - Sharding consistency checks - Blue-green
            deployment support - Schema template management</p>
            <h2 id="implementation-example">Implementation Example</h2>
            <h3 id="enhanced-control-file">Enhanced Control File</h3>
            <div class="sourceCode" id="cb9"><pre
            class="sourceCode ini"><code class="sourceCode ini"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pg_gitversion.control</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">comment </span><span class="ot">=</span><span class="st"> &#39;Git-like version control for PostgreSQL schemas&#39;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dt">default_version </span><span class="ot">=</span><span class="st"> &#39;1.1.0&#39;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="dt">module_pathname </span><span class="ot">=</span><span class="st"> &#39;$libdir/pg_gitversion&#39;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="dt">relocatable </span><span class="ot">=</span><span class="st"> </span><span class="kw">false</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="dt">requires </span><span class="ot">=</span><span class="st"> &#39;&#39;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="dt">superuser </span><span class="ot">=</span><span class="st"> </span><span class="kw">false</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="dt">schema </span><span class="ot">=</span><span class="st"> gitversion</span></span></code></pre></div>
            <h3 id="module-management">Module Management</h3>
            <div class="sourceCode" id="cb10"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Module tracking table</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> gitversion.modules (</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    name TEXT <span class="kw">PRIMARY</span> <span class="kw">KEY</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    enabled <span class="dt">BOOLEAN</span> <span class="kw">DEFAULT</span> <span class="kw">false</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    enabled_at <span class="dt">TIMESTAMP</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    enabled_by TEXT,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    version TEXT,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    dependencies TEXT[]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Module management functions</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">FUNCTION</span> gitversion.enable_module(module_name TEXT)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>RETURNS <span class="dt">BOOLEAN</span> <span class="kw">AS</span> $$</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    module_file TEXT;</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Validate module exists</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">IF</span> module_name <span class="kw">NOT</span> <span class="kw">IN</span> (<span class="st">&#39;sync&#39;</span>, <span class="st">&#39;advanced&#39;</span>) <span class="cf">THEN</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>        RAISE <span class="kw">EXCEPTION</span> <span class="st">&#39;Unknown module: %&#39;</span>, module_name;</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="cf">IF</span>;</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Check if already enabled</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">IF</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="dv">1</span> <span class="kw">FROM</span> gitversion.modules <span class="kw">WHERE</span> name <span class="op">=</span> module_name <span class="kw">AND</span> enabled <span class="op">=</span> <span class="kw">true</span>) <span class="cf">THEN</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">RETURN</span> <span class="kw">false</span>; <span class="co">-- Already enabled</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="cf">IF</span>;</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Load module SQL</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    module_file <span class="op">:=</span> format(<span class="st">&#39;sql/%s_%s_module.sql&#39;</span>, </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">CASE</span> module_name</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">WHEN</span> <span class="st">&#39;sync&#39;</span> <span class="cf">THEN</span> <span class="st">&#39;010&#39;</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">WHEN</span> <span class="st">&#39;advanced&#39;</span> <span class="cf">THEN</span> <span class="st">&#39;011&#39;</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">END</span>,</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>        module_name</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    );</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Execute module installation</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">EXECUTE</span> format(<span class="st">&#39;SELECT gitversion.load_module_file(%L)&#39;</span>, module_file);</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Record as enabled</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">INSERT</span> <span class="kw">INTO</span> gitversion.modules (name, enabled, enabled_at, enabled_by, version)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">VALUES</span> (module_name, <span class="kw">true</span>, <span class="fu">CURRENT_TIMESTAMP</span>, CURRENT_USER, <span class="st">&#39;1.1.0&#39;</span>)</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> CONFLICT (name) DO <span class="kw">UPDATE</span> <span class="kw">SET</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>        enabled <span class="op">=</span> <span class="kw">true</span>,</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>        enabled_at <span class="op">=</span> <span class="fu">CURRENT_TIMESTAMP</span>,</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>        enabled_by <span class="op">=</span> CURRENT_USER;</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">RETURN</span> <span class="kw">true</span>;</span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span>;</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>$$ LANGUAGE plpgsql;</span></code></pre></div>
            <h3 id="usage-examples">Usage Examples</h3>
            <div class="sourceCode" id="cb11"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Start with core tracking</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> EXTENSION pg_gitversion;</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> users (<span class="kw">id</span> SERIAL <span class="kw">PRIMARY</span> <span class="kw">KEY</span>, email TEXT);</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> gitversion.get_version(<span class="st">&#39;public.users&#39;</span>); <span class="co">-- Works</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- Enable sync when needed</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> gitversion.enable_module(<span class="st">&#39;sync&#39;</span>);</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> gitversion.sync_add_remote(<span class="st">&#39;production&#39;</span>, <span class="st">&#39;postgresql://...&#39;</span>);</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> gitversion.sync_compare_schemas(<span class="st">&#39;production&#39;</span>); <span class="co">-- Now works</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Enable advanced features for complex scenarios</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> gitversion.enable_module(<span class="st">&#39;advanced&#39;</span>);</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> gitversion.advanced_setup_tenant_template(<span class="st">&#39;saas_template&#39;</span>);</span></code></pre></div>
            <h2 id="alternative-extension-family">Alternative: Extension
            Family</h2>
            <p>If the single extension becomes too complex, we could
            create an extension family:</p>
            <div class="sourceCode" id="cb12"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Base extension</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> EXTENSION pg_gitversion;</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Optional extensions that depend on base</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> EXTENSION pg_gitversion_sync;    <span class="co">-- Requires pg_gitversion</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> EXTENSION pg_gitversion_advanced; <span class="co">-- Requires pg_gitversion</span></span></code></pre></div>
            <p>But given the deep integration enabled by DDL hashing,
            the modular single-extension approach seems optimal.</p>
            <h2 id="decision-rationale">Decision Rationale</h2>
            <ol type="1">
            <li><strong>DDL Hashing Changes Everything</strong>: The
            shared hashing infrastructure creates too many synergies to
            ignore</li>
            <li><strong>User Experience</strong>: Single extension with
            optional features is simpler than managing multiple
            extensions</li>
            <li><strong>Maintenance</strong>: Easier to maintain
            consistent data models and APIs</li>
            <li><strong>Performance</strong>: Shared infrastructure
            avoids duplication and improves efficiency</li>
            <li><strong>Future Growth</strong>: Modular design allows
            adding new capabilities without architectural changes</li>
            </ol>
            <h2 id="conclusion">Conclusion</h2>
            <p><strong>Recommended</strong>: Single
            <code>pg_gitversion</code> extension with optional sync and
            advanced modules, enabled on-demand through
            <code>gitversion.enable_module()</code>.</p>
            <p>This provides the benefits of both approaches: unified
            infrastructure with optional complexity.</p>
        </article>
    </main>
    
    <footer>
        <p>pgGit is open source software under the MIT License</p>
        <p>Built with ❤️ by <a href="https://github.com/evoludigit">@evoludigit</a></p>
    </footer>
</body>
</html>