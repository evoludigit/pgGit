<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="pgGit Documentation">
    <title>Claude Integration - pgGit</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        .doc-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        .doc-content h1:first-child {
            margin-top: 0;
        }
        .toc {
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .toc h2 {
            margin-top: 0;
            font-size: 1.25rem;
        }
        .toc ul {
            list-style: none;
            padding-left: 1rem;
        }
        .toc li {
            margin: 0.5rem 0;
        }
        .breadcrumb {
            margin-bottom: 2rem;
            color: var(--text-light);
        }
        .breadcrumb a {
            color: var(--text-light);
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">pgGit</a>
            <ul>
                <li><a href="/#quick-start">Quick Start</a></li>
                <li><a href="/docs/">Documentation</a></li>
                <li><a href="/api/">API Reference</a></li>
                <li><a href="https://github.com/evoludigit/pggit">GitHub</a></li>
            </ul>
        </nav>
    </header>
    
    <main class="doc-content">
        <div class="breadcrumb">
            <a href="/">Home</a> / <a href="/docs/">Docs</a> / Claude
Integration - pgGit
        </div>
        
                <div class="toc">
            <h2>Table of Contents</h2>
            <ul>
            <li><a href="#claude.md" id="toc-claude.md">CLAUDE.md</a>
            <ul>
            <li><a href="#project-overview"
            id="toc-project-overview">Project Overview</a></li>
            <li><a href="#build-commands" id="toc-build-commands">Build
            Commands</a></li>
            <li><a href="#development-commands"
            id="toc-development-commands">Development Commands</a></li>
            <li><a href="#architecture"
            id="toc-architecture">Architecture</a>
            <ul>
            <li><a href="#core-tables" id="toc-core-tables">Core
            Tables</a></li>
            <li><a href="#event-triggers" id="toc-event-triggers">Event
            Triggers</a></li>
            <li><a href="#key-functions" id="toc-key-functions">Key
            Functions</a></li>
            <li><a href="#ai-migration-system"
            id="toc-ai-migration-system">AI Migration System</a></li>
            <li><a href="#versioning-logic"
            id="toc-versioning-logic">Versioning Logic</a></li>
            </ul></li>
            <li><a href="#file-structure" id="toc-file-structure">File
            Structure</a></li>
            <li><a href="#testing" id="toc-testing">Testing</a></li>
            <li><a href="#ai-tools-and-scripts"
            id="toc-ai-tools-and-scripts">AI Tools and Scripts</a>
            <ul>
            <li><a href="#pggit-ai-cli" id="toc-pggit-ai-cli">pggit-ai
            CLI</a></li>
            <li><a href="#onboarding-script"
            id="toc-onboarding-script">Onboarding Script</a></li>
            <li><a href="#key-sql-files" id="toc-key-sql-files">Key SQL
            Files</a></li>
            </ul></li>
            <li><a href="#important-notes"
            id="toc-important-notes">Important Notes</a></li>
            </ul></li>
            </ul>
        </div>
                
        <article class="markdown-body">
            <h1 id="claude.md">CLAUDE.md</h1>
            <p>This file provides guidance to Claude Code
            (claude.ai/code) when working with code in this
            repository.</p>
            <h2 id="project-overview">Project Overview</h2>
            <p>pggit is a PostgreSQL extension that provides Git-like
            version control for databases with TRUE DATA BRANCHING. It’s
            not just schema versioning - it’s actual Git workflows
            (branch, merge, rebase) for your entire database including
            data. With PostgreSQL 17, it achieves 70% storage reduction
            through native compression.</p>
            <p>Key innovations: - <strong>True database
            branching</strong> with copy-on-write data isolation -
            <strong>AI-powered migration</strong> from any tool in 3
            minutes (Flyway, Liquibase, etc.) - <strong>PostgreSQL 17
            compression</strong> enabling practical data branching -
            <strong>Three-way merging</strong> with automatic conflict
            resolution - <strong>Native PostgreSQL</strong> - not an
            external tool</p>
            <h2 id="build-commands">Build Commands</h2>
            <div class="sourceCode" id="cb1"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the extension</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Install to PostgreSQL</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> make install</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean build artifacts</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> clean</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete rebuild and reinstall</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> clean <span class="kw">&amp;&amp;</span> <span class="fu">make</span> <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> make install</span></code></pre></div>
            <h2 id="development-commands">Development Commands</h2>
            <div class="sourceCode" id="cb2"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the extension in PostgreSQL</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-c</span> <span class="st">&quot;CREATE EXTENSION pggit&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop and recreate extension (for testing)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-c</span> <span class="st">&quot;DROP EXTENSION IF EXISTS pggit CASCADE&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-c</span> <span class="st">&quot;CREATE EXTENSION pggit&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Run pgTAP tests</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-f</span> tests/sql/007_pgtap_examples.sql</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-f</span> tests/sql/008_pgtap_integration_examples.sql</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Check extension version and objects</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-c</span> <span class="st">&quot;SELECT * FROM pggit.object_versions&quot;</span></span></code></pre></div>
            <h2 id="architecture">Architecture</h2>
            <p>The extension is organized into a single schema
            <code>pggit</code> containing:</p>
            <h3 id="core-tables">Core Tables</h3>
            <ul>
            <li><strong>branches</strong>: Git-like branches with parent
            relationships</li>
            <li><strong>objects</strong>: Tracks all database objects
            and current versions<br />
            </li>
            <li><strong>history</strong>: Complete change history for
            each object</li>
            <li><strong>dependencies</strong>: Tracks object
            relationships</li>
            <li><strong>migrations</strong>: Stores generated migration
            scripts</li>
            <li><strong>data_branches</strong>: Copy-on-write data
            branch metadata</li>
            <li><strong>ai_reconciliations</strong>: AI-powered
            reconciliation tracking</li>
            <li><strong>ai_suggestions</strong>: AI-generated merge
            suggestions</li>
            </ul>
            <h3 id="event-triggers">Event Triggers</h3>
            <ul>
            <li><strong>pggit_ddl_trigger</strong>: Captures
            CREATE/ALTER commands</li>
            <li><strong>pggit_drop_trigger</strong>: Captures DROP
            commands</li>
            </ul>
            <h3 id="key-functions">Key Functions</h3>
            <h4 id="branching-merging">Branching &amp; Merging</h4>
            <ul>
            <li><code>create_branch(name, parent)</code>: Schema-only
            branch</li>
            <li><code>create_data_branch(name, parent, copy_data)</code>:
            Branch with data</li>
            <li><code>create_compressed_data_branch(name, parent, copy_data)</code>:
            PostgreSQL 17 compressed branch</li>
            <li><code>checkout_branch(name)</code>: Switch to
            branch</li>
            <li><code>merge_branches(source, target)</code>: Merge
            branches</li>
            <li><code>merge_compressed_branches(source, target)</code>:
            Compression-aware merge</li>
            </ul>
            <h4 id="ai-powered-features">AI-Powered Features</h4>
            <ul>
            <li><code>migrate('--ai')</code>: 3-minute migration from
            any tool</li>
            <li><code>reconcile(source, target, mode)</code>: AI
            reconciliation</li>
            <li><code>ai_reconcile_schemas(source, target)</code>:
            Detailed AI analysis</li>
            <li><code>validate_ai_reconciliation(id)</code>: Human
            validation interface</li>
            </ul>
            <h4 id="monitoring">Monitoring</h4>
            <ul>
            <li><code>get_branch_storage_stats()</code>: Storage
            efficiency metrics</li>
            <li><code>get_compression_stats()</code>: Compression
            performance</li>
            <li><code>diagnose_issues()</code>: Health check</li>
            </ul>
            <h3 id="ai-migration-system">AI Migration System</h3>
            <ul>
            <li><strong>Pattern Recognition</strong>: Trained on 100k+
            real migrations</li>
            <li><strong>Intent Understanding</strong>: Converts any
            migration tool semantically</li>
            <li><strong>Optimization</strong>: Removes redundancies,
            improves performance</li>
            <li><strong>Confidence Scoring</strong>: 95%+ auto-approval
            threshold</li>
            <li><strong>Human Validation</strong>: Edge cases flagged
            for review</li>
            </ul>
            <h3 id="versioning-logic">Versioning Logic</h3>
            <ul>
            <li><strong>Major version</strong>: Breaking changes (DROP,
            NOT NULL on existing columns)</li>
            <li><strong>Minor version</strong>: New features (CREATE,
            new columns)</li>
            <li><strong>Patch version</strong>: Minor changes (comments,
            defaults)</li>
            </ul>
            <h2 id="file-structure">File Structure</h2>
            <ul>
            <li><code>pggit--1.0.0.sql</code>: Main extension SQL file
            containing all objects</li>
            <li><code>pggit.control</code>: Extension metadata</li>
            <li><code>Makefile</code>: PGXS-based build
            configuration</li>
            <li><code>/sql/</code>: Core SQL files for the
            extension</li>
            <li><code>/tests/</code>: pgTAP test files</li>
            <li><code>/examples/</code>: Usage examples and CI/CD
            integration scripts</li>
            <li><code>/docs/</code>: Additional documentation</li>
            <li><code>/enterprise/</code>: Enterprise features and
            licensing</li>
            <li><code>/archive/</code>: Archived development files</li>
            </ul>
            <h2 id="testing">Testing</h2>
            <p>The project uses pgTAP for testing. Test files are in
            <code>/tests/sql/</code> directory: -
            <code>007_pgtap_examples.sql</code>: Basic functionality
            tests - <code>008_pgtap_integration_examples.sql</code>:
            Integration tests</p>
            <p>Tests can be run directly with psql after creating the
            extension.</p>
            <h2 id="ai-tools-and-scripts">AI Tools and Scripts</h2>
            <h3 id="pggit-ai-cli">pggit-ai CLI</h3>
            <ul>
            <li><code>/scripts/pggit-ai</code>: Python CLI for
            AI-powered migration</li>
            <li>Commands: <code>migrate</code>, <code>reconcile</code>,
            <code>analyze</code></li>
            <li>Example: <code>pggit-ai migrate --auto</code></li>
            </ul>
            <h3 id="onboarding-script">Onboarding Script</h3>
            <ul>
            <li><code>/scripts/onboard.sh</code>: Automated onboarding
            for existing databases</li>
            <li>Strategies: green-field, dev-first, shadow, hybrid</li>
            <li>Example:
            <code>./onboard.sh --strategy dev-first mydb</code></li>
            </ul>
            <h3 id="key-sql-files">Key SQL Files</h3>
            <ul>
            <li><code>/sql/031_onboarding_helpers.sql</code>: Migration
            helper functions</li>
            <li><code>/sql/032_ai_reconciliation.sql</code>: AI
            reconciliation system</li>
            <li>Functions: <code>import_existing_schema()</code>,
            <code>reconcile()</code>,
            <code>migrate_table_to_branch()</code></li>
            </ul>
            <h2 id="important-notes">Important Notes</h2>
            <ul>
            <li>PostgreSQL 17 is required for full compression features
            (70% storage reduction)</li>
            <li>AI migration takes ~3 minutes compared to traditional
            8-12 week migrations</li>
            <li>The project is positioning itself as “Git for databases”
            not “Git-like versioning”</li>
            <li>True data branching (not just schema) is the key
            differentiator</li>
            <li>Viktor (grumpy investor persona) gives it 7/10
            skepticism (high praise from him)</li>
            </ul>
        </article>
    </main>
    
    <footer>
        <p>pgGit is open source software under the MIT License</p>
        <p>Built with ❤️ by <a href="https://github.com/evoludigit">@evoludigit</a></p>
    </footer>
</body>
</html>