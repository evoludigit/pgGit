<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="pgGit Documentation">
    <title>Troubleshooting - pgGit</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        .doc-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        .doc-content h1:first-child {
            margin-top: 0;
        }
        .toc {
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .toc h2 {
            margin-top: 0;
            font-size: 1.25rem;
        }
        .toc ul {
            list-style: none;
            padding-left: 1rem;
        }
        .toc li {
            margin: 0.5rem 0;
        }
        .breadcrumb {
            margin-bottom: 2rem;
            color: var(--text-light);
        }
        .breadcrumb a {
            color: var(--text-light);
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="/" class="logo">pgGit</a>
            <ul>
                <li><a href="/#quick-start">Quick Start</a></li>
                <li><a href="/docs/">Documentation</a></li>
                <li><a href="/api/">API Reference</a></li>
                <li><a href="https://github.com/evoludigit/pggit">GitHub</a></li>
            </ul>
        </nav>
    </header>
    
    <main class="doc-content">
        <div class="breadcrumb">
            <a href="/">Home</a> / <a href="/docs/">Docs</a> / Troubleshooting
- pgGit
        </div>
        
                <div class="toc">
            <h2>Table of Contents</h2>
            <ul>
            <li><a href="#pggit-troubleshooting-guide"
            id="toc-pggit-troubleshooting-guide">pggit Troubleshooting
            Guide</a>
            <ul>
            <li><a href="#quick-diagnosis"
            id="toc-quick-diagnosis">Quick Diagnosis</a></li>
            <li><a href="#installation-issues"
            id="toc-installation-issues">ðŸš¨ Installation Issues</a>
            <ul>
            <li><a href="#extension-wont-install"
            id="toc-extension-wont-install">Extension Wonâ€™t
            Install</a></li>
            <li><a href="#permission-denied-during-install"
            id="toc-permission-denied-during-install">Permission Denied
            During Install</a></li>
            <li><a href="#incompatible-postgresql-version"
            id="toc-incompatible-postgresql-version">Incompatible
            PostgreSQL Version</a></li>
            </ul></li>
            <li><a href="#branch-management-issues"
            id="toc-branch-management-issues">ðŸŒ¿ Branch Management
            Issues</a>
            <ul>
            <li><a href="#cannot-create-branch"
            id="toc-cannot-create-branch">Cannot Create Branch</a></li>
            <li><a href="#branch-creation-hangs"
            id="toc-branch-creation-hangs">Branch Creation
            Hangs</a></li>
            <li><a href="#cannot-switch-branches"
            id="toc-cannot-switch-branches">Cannot Switch
            Branches</a></li>
            </ul></li>
            <li><a href="#postgresql-17-compression-issues"
            id="toc-postgresql-17-compression-issues">ðŸ’¾ PostgreSQL 17
            Compression Issues</a>
            <ul>
            <li><a href="#compression-not-working"
            id="toc-compression-not-working">Compression Not
            Working</a></li>
            <li><a href="#compression-performance-issues"
            id="toc-compression-performance-issues">Compression
            Performance Issues</a></li>
            </ul></li>
            <li><a href="#merge-conflicts" id="toc-merge-conflicts">ðŸ”€
            Merge Conflicts</a>
            <ul>
            <li><a href="#merge-fails-with-conflicts"
            id="toc-merge-fails-with-conflicts">Merge Fails with
            Conflicts</a></li>
            <li><a href="#merge-corrupts-data"
            id="toc-merge-corrupts-data">Merge Corrupts Data</a></li>
            </ul></li>
            <li><a href="#performance-issues"
            id="toc-performance-issues">ðŸŽ­ Performance Issues</a>
            <ul>
            <li><a href="#slow-branch-operations"
            id="toc-slow-branch-operations">Slow Branch
            Operations</a></li>
            <li><a href="#out-of-disk-space"
            id="toc-out-of-disk-space">Out of Disk Space</a></li>
            </ul></li>
            <li><a href="#common-error-messages"
            id="toc-common-error-messages">ðŸ”§ Common Error Messages</a>
            <ul>
            <li><a href="#error-schema-branch_name-already-exists"
            id="toc-error-schema-branch_name-already-exists"><code>ERROR: schema "branch_name" already exists</code></a></li>
            <li><a
            href="#error-could-not-serialize-access-due-to-concurrent-update"
            id="toc-error-could-not-serialize-access-due-to-concurrent-update"><code>ERROR: could not serialize access due to concurrent update</code></a></li>
            <li><a
            href="#error-function-pggit.create_compressed_data_branch-does-not-exist"
            id="toc-error-function-pggit.create_compressed_data_branch-does-not-exist"><code>ERROR: function pggit.create_compressed_data_branch does not exist</code></a></li>
            </ul></li>
            <li><a href="#monitoring-diagnostics"
            id="toc-monitoring-diagnostics">ðŸ“Š Monitoring &amp;
            Diagnostics</a>
            <ul>
            <li><a href="#health-check-query"
            id="toc-health-check-query">Health Check Query</a></li>
            <li><a href="#performance-monitoring"
            id="toc-performance-monitoring">Performance
            Monitoring</a></li>
            </ul></li>
            <li><a href="#getting-help" id="toc-getting-help">ðŸ†˜ Getting
            Help</a>
            <ul>
            <li><a href="#before-asking-for-help"
            id="toc-before-asking-for-help">Before Asking for
            Help</a></li>
            <li><a href="#where-to-get-help"
            id="toc-where-to-get-help">Where to Get Help</a></li>
            <li><a href="#reporting-bugs"
            id="toc-reporting-bugs">Reporting Bugs</a></li>
            </ul></li>
            <li><a href="#recovery-procedures"
            id="toc-recovery-procedures">ðŸ”„ Recovery Procedures</a>
            <ul>
            <li><a href="#emergency-branch-recovery"
            id="toc-emergency-branch-recovery">Emergency Branch
            Recovery</a></li>
            <li><a href="#full-system-reset-last-resort"
            id="toc-full-system-reset-last-resort">Full System Reset
            (Last Resort)</a></li>
            </ul></li>
            </ul></li>
            </ul>
        </div>
                
        <article class="markdown-body">
            <h1 id="pggit-troubleshooting-guide">pggit Troubleshooting
            Guide</h1>
            <p><em>Solutions to common issues and error
            messages</em></p>
            <h2 id="quick-diagnosis">Quick Diagnosis</h2>
            <p>Before diving into specific issues, run this
            diagnostic:</p>
            <div class="sourceCode" id="cb1"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check pggit health</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pggit.diagnose_issues();</span></code></pre></div>
            <hr />
            <h2 id="installation-issues">ðŸš¨ Installation Issues</h2>
            <h3 id="extension-wont-install">Extension Wonâ€™t Install</h3>
            <p><strong>Error:</strong>
            <code>ERROR: could not open extension control file "/usr/share/postgresql/17/extension/pggit.control": No such file or directory</code></p>
            <p><strong>Causes:</strong> 1. Extension files not in
            PostgreSQL directory 2. Missing PostgreSQL development
            packages 3. Wrong PostgreSQL version</p>
            <p><strong>Solutions:</strong></p>
            <div class="sourceCode" id="cb2"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Verify PostgreSQL version</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">--version</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Install development packages</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ubuntu/Debian:</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install postgresql-server-dev-17</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># RHEL/CentOS:</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> dnf install postgresql17-devel</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># macOS:</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install postgresql@17</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Rebuild and reinstall</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /path/to/pggit</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> clean</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> make install</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Verify installation</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-la</span> /usr/share/postgresql/17/extension/pggit<span class="pp">*</span></span></code></pre></div>
            <h3 id="permission-denied-during-install">Permission Denied
            During Install</h3>
            <p><strong>Error:</strong>
            <code>ERROR: permission denied to create extension "pggit"</code></p>
            <p><strong>Solution:</strong></p>
            <div class="sourceCode" id="cb3"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Connect as superuser</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sudo <span class="op">-</span>u postgres psql <span class="op">-</span>d your_database</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create extension</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> EXTENSION pggit;</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Grant permissions to your user</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">USAGE</span> <span class="kw">ON</span> <span class="kw">SCHEMA</span> pggit <span class="kw">TO</span> your_username;</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">GRANT</span> <span class="kw">EXECUTE</span> <span class="kw">ON</span> <span class="kw">ALL</span> <span class="kw">FUNCTIONS</span> <span class="kw">IN</span> <span class="kw">SCHEMA</span> pggit <span class="kw">TO</span> your_username;</span></code></pre></div>
            <h3 id="incompatible-postgresql-version">Incompatible
            PostgreSQL Version</h3>
            <p><strong>Error:</strong>
            <code>ERROR: extension "pggit" requires PostgreSQL version 14 or higher</code></p>
            <p><strong>Solution:</strong></p>
            <div class="sourceCode" id="cb4"><pre
            class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check your version</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-c</span> <span class="st">&quot;SELECT version();&quot;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If &lt; 14, upgrade PostgreSQL</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Or use pggit with limited features:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="ex">psql</span> <span class="at">-c</span> <span class="st">&quot;CREATE EXTENSION pggit VERSION &#39;1.0.0-compat&#39;;&quot;</span></span></code></pre></div>
            <hr />
            <h2 id="branch-management-issues">ðŸŒ¿ Branch Management
            Issues</h2>
            <h3 id="cannot-create-branch">Cannot Create Branch</h3>
            <p><strong>Error:</strong>
            <code>ERROR: Parent branch 'main' not found</code></p>
            <p><strong>Causes:</strong> 1. No main branch exists 2. Typo
            in branch name 3. Branch was deleted</p>
            <p><strong>Solutions:</strong></p>
            <div class="sourceCode" id="cb5"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check existing branches</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pggit.list_branches();</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create main branch if missing</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> pggit.branches (name, parent_branch_id, status) </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">VALUES</span> (<span class="st">&#39;main&#39;</span>, <span class="kw">NULL</span>, <span class="st">&#39;ACTIVE&#39;</span>);</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Create schema for main</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">SCHEMA</span> <span class="cf">IF</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span> main;</span></code></pre></div>
            <h3 id="branch-creation-hangs">Branch Creation Hangs</h3>
            <p><strong>Error:</strong> Branch creation takes forever on
            large databases</p>
            <p><strong>Causes:</strong> 1. Creating data branch on huge
            tables 2. Insufficient memory 3. Lock conflicts</p>
            <p><strong>Solutions:</strong></p>
            <div class="sourceCode" id="cb6"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Option 1: Create schema-only branch</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.create_branch(<span class="st">&#39;feature/quick&#39;</span>, <span class="st">&#39;main&#39;</span>);  <span class="co">-- No data copy</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Option 2: Create branch with specific tables</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.create_data_branch_selective(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;feature/partial&#39;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;main&#39;</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ARRAY</span>[<span class="st">&#39;users&#39;</span>, <span class="st">&#39;settings&#39;</span>]  <span class="co">-- Only copy these tables</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Option 3: Monitor progress</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pggit.branch_creation_progress;</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- Option 4: Check for locks</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pg_locks <span class="kw">WHERE</span> <span class="kw">NOT</span> granted;</span></code></pre></div>
            <h3 id="cannot-switch-branches">Cannot Switch Branches</h3>
            <p><strong>Error:</strong>
            <code>ERROR: Cannot checkout branch with active transactions</code></p>
            <p><strong>Solution:</strong></p>
            <div class="sourceCode" id="cb7"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check for active transactions</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pg_stat_activity </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> state <span class="op">=</span> <span class="st">&#39;active&#39;</span> <span class="kw">AND</span> pid <span class="op">!=</span> pg_backend_pid();</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Rollback any pending transactions</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">ROLLBACK</span>;</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Then switch branch</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.checkout_branch(<span class="st">&#39;feature/mybranch&#39;</span>);</span></code></pre></div>
            <hr />
            <h2 id="postgresql-17-compression-issues">ðŸ’¾ PostgreSQL 17
            Compression Issues</h2>
            <h3 id="compression-not-working">Compression Not
            Working</h3>
            <p><strong>Error:</strong> Branches created but no
            compression benefit observed</p>
            <p><strong>Causes:</strong> 1. Not using PostgreSQL 17 2.
            Compression not enabled 3. Data not compressible</p>
            <p><strong>Solutions:</strong></p>
            <div class="sourceCode" id="cb8"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- 1. Verify PostgreSQL version</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> version();</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- Should show: PostgreSQL 17.x</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- 2. Check compression settings</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>SHOW default_toast_compression;</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Should show: lz4 or zstd</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- 3. Enable compression</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">SYSTEM</span> <span class="kw">SET</span> default_toast_compression <span class="op">=</span> <span class="st">&#39;lz4&#39;</span>;</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pg_reload_conf();</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- 4. Use compressed branch creation</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.create_compressed_data_branch(<span class="st">&#39;feature/compressed&#39;</span>, <span class="st">&#39;main&#39;</span>, <span class="kw">true</span>);</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">-- 5. Verify compression</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pggit.get_compression_stats();</span></code></pre></div>
            <h3 id="compression-performance-issues">Compression
            Performance Issues</h3>
            <p><strong>Error:</strong> Queries slower on compressed
            branches</p>
            <p><strong>Solutions:</strong></p>
            <div class="sourceCode" id="cb9"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- 1. Check compression ratios</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pggit.get_branch_storage_stats();</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- 2. Analyze tables</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ANALYZE</span>;</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- 3. Adjust compression settings</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> your_table <span class="kw">SET</span> (toast_compression <span class="op">=</span> <span class="st">&#39;lz4&#39;</span>);  <span class="co">-- Faster</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- OR</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">TABLE</span> your_table <span class="kw">SET</span> (toast_compression <span class="op">=</span> <span class="st">&#39;zstd&#39;</span>); <span class="co">-- Better compression</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- 4. Monitor query performance</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="kw">EXPLAIN</span> (<span class="kw">ANALYZE</span>, BUFFERS) <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> your_table;</span></code></pre></div>
            <hr />
            <h2 id="merge-conflicts">ðŸ”€ Merge Conflicts</h2>
            <h3 id="merge-fails-with-conflicts">Merge Fails with
            Conflicts</h3>
            <p><strong>Error:</strong>
            <code>CONFLICTS_DETECTED:merge_abc123</code></p>
            <p><strong>Solutions:</strong></p>
            <div class="sourceCode" id="cb10"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- 1. Analyze conflicts</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pggit.analyze_merge_conflicts(<span class="st">&#39;merge_abc123&#39;</span>);</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- 2. Auto-resolve with strategy</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.auto_resolve_compressed_conflicts(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;merge_abc123&#39;</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;COMPRESSION_OPTIMIZED&#39;</span>  <span class="co">-- or &#39;TAKE_SOURCE&#39; or &#39;TAKE_TARGET&#39;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- 3. Manual resolution</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pggit.show_conflict_diff(<span class="st">&#39;merge_abc123&#39;</span>, <span class="dv">1</span>);</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- Then resolve each conflict manually</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- 4. Retry merge</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.retry_merge(<span class="st">&#39;merge_abc123&#39;</span>);</span></code></pre></div>
            <h3 id="merge-corrupts-data">Merge Corrupts Data</h3>
            <p><strong>Error:</strong> Data inconsistent after merge</p>
            <p><strong>Emergency Recovery:</strong></p>
            <div class="sourceCode" id="cb11"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- 1. Immediately rollback the merge</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.rollback_merge(<span class="st">&#39;merge_abc123&#39;</span>);</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- 2. Restore from branch backup</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.restore_branch_backup(<span class="st">&#39;main&#39;</span>, <span class="st">&#39;before_merge_abc123&#39;</span>);</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- 3. Validate data integrity</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pggit.validate_branch_integrity(<span class="st">&#39;main&#39;</span>);</span></code></pre></div>
            <hr />
            <h2 id="performance-issues">ðŸŽ­ Performance Issues</h2>
            <h3 id="slow-branch-operations">Slow Branch Operations</h3>
            <p><strong>Symptoms:</strong> - Branch creation takes &gt; 5
            minutes - Switching branches is slow - Queries perform
            poorly</p>
            <p><strong>Diagnosis:</strong></p>
            <div class="sourceCode" id="cb12"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Check branch statistics</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    branch_name,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    table_count,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    total_size,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    compression_ratio,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    age(created_at) <span class="kw">as</span> branch_age</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> pggit.get_branch_storage_stats()</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> total_size <span class="kw">DESC</span>;</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- Find large tables</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    schemaname,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    tablename,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    pg_size_pretty(pg_total_relation_size(schemaname<span class="op">||</span><span class="st">&#39;.&#39;</span><span class="op">||</span>tablename)) <span class="kw">as</span> <span class="kw">size</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> pg_tables</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> schemaname <span class="op">=</span> <span class="st">&#39;your_branch&#39;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> pg_total_relation_size(schemaname<span class="op">||</span><span class="st">&#39;.&#39;</span><span class="op">||</span>tablename) <span class="kw">DESC</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
            <p><strong>Solutions:</strong></p>
            <div class="sourceCode" id="cb13"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- 1. Use schema-only branches for CI/CD</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.create_branch(<span class="st">&#39;ci/fast-branch&#39;</span>, <span class="st">&#39;main&#39;</span>);  <span class="co">-- No data</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- 2. Optimize storage</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.optimize_storage();</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- 3. Clean up old branches</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.cleanup_merged_branches(<span class="kw">false</span>);</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- 4. Increase memory</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">SYSTEM</span> <span class="kw">SET</span> work_mem <span class="op">=</span> <span class="st">&#39;256MB&#39;</span>;</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> <span class="kw">SYSTEM</span> <span class="kw">SET</span> maintenance_work_mem <span class="op">=</span> <span class="st">&#39;1GB&#39;</span>;</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pg_reload_conf();</span></code></pre></div>
            <h3 id="out-of-disk-space">Out of Disk Space</h3>
            <p><strong>Error:</strong>
            <code>ERROR: could not extend file: No space left on device</code></p>
            <p><strong>Solutions:</strong></p>
            <div class="sourceCode" id="cb14"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- 1. Check space usage</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pggit.get_branch_storage_stats();</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- 2. Find large branches</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    branch_name,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    pg_size_pretty(<span class="fu">SUM</span>(pg_total_relation_size(table_schema<span class="op">||</span><span class="st">&#39;.&#39;</span><span class="op">||</span>table_name))) <span class="kw">as</span> total_size</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> pggit.data_branches</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> branch_name</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="fu">SUM</span>(pg_total_relation_size(table_schema<span class="op">||</span><span class="st">&#39;.&#39;</span><span class="op">||</span>table_name)) <span class="kw">DESC</span>;</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- 3. Clean up merged branches</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.cleanup_merged_branches(<span class="kw">false</span>);</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">-- 4. Drop old test branches</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>DO $$</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="kw">DECLARE</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    r <span class="dt">RECORD</span>;</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">FOR</span> r <span class="kw">IN</span> </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>        <span class="kw">SELECT</span> name <span class="kw">FROM</span> pggit.branches </span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">WHERE</span> name <span class="kw">LIKE</span> <span class="st">&#39;ci/%&#39;</span> </span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">AND</span> created_at <span class="op">&lt;</span> <span class="fu">CURRENT_TIMESTAMP</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;7 days&#39;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">LOOP</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">EXECUTE</span> format(<span class="st">&#39;DROP SCHEMA %I CASCADE&#39;</span>, r.name);</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">DELETE</span> <span class="kw">FROM</span> pggit.branches <span class="kw">WHERE</span> name <span class="op">=</span> r.name;</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> <span class="cf">LOOP</span>;</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> $$;</span></code></pre></div>
            <hr />
            <h2 id="common-error-messages">ðŸ”§ Common Error Messages</h2>
            <h3
            id="error-schema-branch_name-already-exists"><code>ERROR: schema "branch_name" already exists</code></h3>
            <p><strong>Cause:</strong> Branch name conflicts with
            existing schema</p>
            <p><strong>Solution:</strong></p>
            <div class="sourceCode" id="cb15"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Use a different branch name</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.create_branch(<span class="st">&#39;feature/unique-name&#39;</span>, <span class="st">&#39;main&#39;</span>);</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Or clean up the existing schema</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">SCHEMA</span> branch_name <span class="kw">CASCADE</span>;</span></code></pre></div>
            <h3
            id="error-could-not-serialize-access-due-to-concurrent-update"><code>ERROR: could not serialize access due to concurrent update</code></h3>
            <p><strong>Cause:</strong> Concurrent modifications to same
            branch</p>
            <p><strong>Solution:</strong></p>
            <div class="sourceCode" id="cb16"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Use advisory locks</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pg_advisory_lock(hashtext(<span class="st">&#39;pggit_branch_&#39;</span> <span class="op">||</span> <span class="st">&#39;branch_name&#39;</span>));</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- Do your operations</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pg_advisory_unlock(hashtext(<span class="st">&#39;pggit_branch_&#39;</span> <span class="op">||</span> <span class="st">&#39;branch_name&#39;</span>));</span></code></pre></div>
            <h3
            id="error-function-pggit.create_compressed_data_branch-does-not-exist"><code>ERROR: function pggit.create_compressed_data_branch does not exist</code></h3>
            <p><strong>Cause:</strong> Using PostgreSQL &lt; 17 or old
            pggit version</p>
            <p><strong>Solution:</strong></p>
            <div class="sourceCode" id="cb17"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Use standard branch creation</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> pggit.create_data_branch(<span class="st">&#39;feature/standard&#39;</span>, <span class="st">&#39;main&#39;</span>, <span class="kw">true</span>);</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Or upgrade PostgreSQL to 17</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- Then reinstall pggit</span></span></code></pre></div>
            <hr />
            <h2 id="monitoring-diagnostics">ðŸ“Š Monitoring &amp;
            Diagnostics</h2>
            <h3 id="health-check-query">Health Check Query</h3>
            <div class="sourceCode" id="cb18"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Comprehensive pggit health check</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> health_checks <span class="kw">AS</span> (</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="st">&#39;PostgreSQL Version&#39;</span> <span class="kw">as</span> check_name,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>           <span class="cf">CASE</span> <span class="cf">WHEN</span> current_setting(<span class="st">&#39;server_version_num&#39;</span>):<span class="ch">:int</span> <span class="op">&gt;=</span> <span class="dv">170000</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                <span class="cf">THEN</span> <span class="st">&#39;PASS&#39;</span> <span class="cf">ELSE</span> <span class="st">&#39;WARN&#39;</span> <span class="cf">END</span> <span class="kw">as</span> status,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;Version: &#39;</span> <span class="op">||</span> version() <span class="kw">as</span> details</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="st">&#39;pggit Schema&#39;</span>, </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>           <span class="cf">CASE</span> <span class="cf">WHEN</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="dv">1</span> <span class="kw">FROM</span> pg_namespace <span class="kw">WHERE</span> nspname <span class="op">=</span> <span class="st">&#39;pggit&#39;</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                <span class="cf">THEN</span> <span class="st">&#39;PASS&#39;</span> <span class="cf">ELSE</span> <span class="st">&#39;FAIL&#39;</span> <span class="cf">END</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;Schema exists: &#39;</span> <span class="op">||</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="dv">1</span> <span class="kw">FROM</span> pg_namespace <span class="kw">WHERE</span> nspname <span class="op">=</span> <span class="st">&#39;pggit&#39;</span>):<span class="ch">:text</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="st">&#39;Compression Enabled&#39;</span>,</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>           <span class="cf">CASE</span> <span class="cf">WHEN</span> current_setting(<span class="st">&#39;default_toast_compression&#39;</span>) <span class="kw">IN</span> (<span class="st">&#39;lz4&#39;</span>, <span class="st">&#39;zstd&#39;</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">THEN</span> <span class="st">&#39;PASS&#39;</span> <span class="cf">ELSE</span> <span class="st">&#39;WARN&#39;</span> <span class="cf">END</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;Setting: &#39;</span> <span class="op">||</span> current_setting(<span class="st">&#39;default_toast_compression&#39;</span>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="st">&#39;Active Branches&#39;</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>           <span class="cf">CASE</span> <span class="cf">WHEN</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">THEN</span> <span class="st">&#39;PASS&#39;</span> <span class="cf">ELSE</span> <span class="st">&#39;WARN&#39;</span> <span class="cf">END</span>,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;Count: &#39;</span> <span class="op">||</span> <span class="fu">COUNT</span>(<span class="op">*</span>):<span class="ch">:text</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> pggit.branches <span class="kw">WHERE</span> status <span class="op">=</span> <span class="st">&#39;ACTIVE&#39;</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> health_checks;</span></code></pre></div>
            <h3 id="performance-monitoring">Performance Monitoring</h3>
            <div class="sourceCode" id="cb19"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Monitor branch operation performance</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> <span class="kw">VIEW</span> pggit.performance_monitor <span class="kw">AS</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    operation_type,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    branch_name,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    duration_ms,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    objects_affected,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    storage_change_mb,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    performed_at</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> pggit.operation_log</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> performed_at <span class="op">&gt;</span> <span class="fu">CURRENT_TIMESTAMP</span> <span class="op">-</span> <span class="dt">INTERVAL</span> <span class="st">&#39;24 hours&#39;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> performed_at <span class="kw">DESC</span>;</span></code></pre></div>
            <hr />
            <h2 id="getting-help">ðŸ†˜ Getting Help</h2>
            <h3 id="before-asking-for-help">Before Asking for Help</h3>
            <ol type="1">
            <li>Run the diagnostic query above</li>
            <li>Check PostgreSQL logs:
            <code>tail -f /var/log/postgresql/postgresql-17-main.log</code></li>
            <li>Verify pggit version:
            <code>SELECT * FROM pg_extension WHERE extname = 'pggit';</code></li>
            <li>Document the exact error message and steps to
            reproduce</li>
            </ol>
            <h3 id="where-to-get-help">Where to Get Help</h3>
            <ul>
            <li><strong>GitHub Issues</strong>: <a
            href="https://github.com/evoludigit/pggit/issues">github.com/evoludigit/pggit/issues</a></li>
            <li><strong>Discussions</strong>: <a
            href="https://github.com/evoludigit/pggit/discussions">github.com/evoludigit/pggit/discussions</a></li>
            <li><strong>Email Support</strong>: <a
            href="mailto:support@pggit.dev">support@pggit.dev</a></li>
            </ul>
            <h3 id="reporting-bugs">Reporting Bugs</h3>
            <p>Include: 1. PostgreSQL version 2. pggit version 3.
            Operating system 4. Complete error message 5. Steps to
            reproduce 6. Output of diagnostic query</p>
            <hr />
            <h2 id="recovery-procedures">ðŸ”„ Recovery Procedures</h2>
            <h3 id="emergency-branch-recovery">Emergency Branch
            Recovery</h3>
            <div class="sourceCode" id="cb20"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- If a branch is corrupted</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span>;</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- 1. Mark branch as inactive</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">UPDATE</span> pggit.branches <span class="kw">SET</span> status <span class="op">=</span> <span class="st">&#39;CORRUPTED&#39;</span> <span class="kw">WHERE</span> name <span class="op">=</span> <span class="st">&#39;problem_branch&#39;</span>;</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- 2. Create recovery branch from last known good state</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> pggit.create_branch(<span class="st">&#39;recovery/problem_branch&#39;</span>, <span class="st">&#39;main&#39;</span>);</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- 3. Restore data from backup if available</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- psql -f branch_backup.sql</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- 4. Validate recovery</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pggit.validate_branch_integrity(<span class="st">&#39;recovery/problem_branch&#39;</span>);</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="kw">COMMIT</span>;</span></code></pre></div>
            <h3 id="full-system-reset-last-resort">Full System Reset
            (Last Resort)</h3>
            <div class="sourceCode" id="cb21"><pre
            class="sourceCode sql"><code class="sourceCode sql"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- </span><span class="al">WARNING</span><span class="co">: This will remove all pggit data!</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="cf">BEGIN</span>;</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DROP</span> EXTENSION pggit <span class="kw">CASCADE</span>;</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DROP</span> <span class="kw">SCHEMA</span> <span class="cf">IF</span> <span class="kw">EXISTS</span> pggit <span class="kw">CASCADE</span>;</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Drop all branch schemas</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    DO $$</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">DECLARE</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        r <span class="dt">RECORD</span>;</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">BEGIN</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">FOR</span> r <span class="kw">IN</span> <span class="kw">SELECT</span> nspname <span class="kw">FROM</span> pg_namespace </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                 <span class="kw">WHERE</span> nspname <span class="kw">LIKE</span> <span class="st">&#39;feature/%&#39;</span> <span class="kw">OR</span> nspname <span class="kw">LIKE</span> <span class="st">&#39;ci/%&#39;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">LOOP</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">EXECUTE</span> format(<span class="st">&#39;DROP SCHEMA %I CASCADE&#39;</span>, r.nspname);</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">END</span> <span class="cf">LOOP</span>;</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">END</span> $$;</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Reinstall</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CREATE</span> EXTENSION pggit;</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="kw">COMMIT</span>;</span></code></pre></div>
            <hr />
            <p><em>Remember: Most issues can be prevented with regular
            maintenance and following best practices. When in doubt,
            create a backup before attempting fixes.</em></p>
        </article>
    </main>
    
    <footer>
        <p>pgGit is open source software under the MIT License</p>
        <p>Built with â¤ï¸ by <a href="https://github.com/evoludigit">@evoludigit</a></p>
    </footer>
</body>
</html>