<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="pgGit API Reference - Complete function documentation">
    <title>API Reference - pgGit</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='24' font-size='24'>üêò</text></svg>">
</head>
<body>
    <nav class="nav" role="navigation" aria-label="Main navigation">
        <div class="nav-inner">
            <a href="/" class="nav-logo">pgGit</a>
            <ul class="nav-links">
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="api.html" aria-current="page">API Reference</a></li>
                <li><a href="examples.html">Examples</a></li>
                <li><a href="troubleshooting.html">Troubleshooting</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <h1>pgGit API Reference</h1>
        
        <section>
            <h2>Core Functions</h2>
            
            <h3 id="status">pggit.status()</h3>
            <p>Shows the current branch, pending changes, and latest commit.</p>
            <pre><code>SELECT * FROM pggit.status();

-- Returns:
-- branch | changes_staged | current_commit | commit_message</code></pre>
            <p><strong>What you're probably thinking:</strong> "What's my current state?" This answers that.</p>

            <h3 id="commit">pggit.commit(message TEXT)</h3>
            <p>Creates a new commit with all staged changes.</p>
            <pre><code>SELECT pggit.commit('Add customer table');

-- Returns: commit UUID or NULL if no changes</code></pre>
            <p><strong>Common gotcha:</strong> Returns NULL if there are no changes. Check <code>status()</code> first.</p>

            <h3 id="checkout">pggit.checkout(branch_name TEXT)</h3>
            <p>Switch to an existing branch.</p>
            <pre><code>SELECT pggit.checkout('main');

-- Returns: 'Switched to branch ''main'''</code></pre>
            <p><strong>Note:</strong> This actually changes your schema to match the branch state!</p>

            <h3 id="checkout_b">pggit.checkout_b(branch_name TEXT)</h3>
            <p>Create and switch to a new branch.</p>
            <pre><code>SELECT pggit.checkout_b('feature/new-api');

-- Returns: 'Switched to branch ''feature/new-api'''</code></pre>
            <p><strong>Pro tip:</strong> Branch names can use letters, numbers, hyphens, underscores, and slashes.</p>
        </section>

        <section>
            <h2>Branching & Merging</h2>
            
            <h3 id="create_branch">pggit.create_branch(branch_name TEXT, from_branch TEXT DEFAULT NULL)</h3>
            <p>Create a new branch without switching to it.</p>
            <pre><code>-- Branch from current
SELECT pggit.create_branch('experiment');

-- Branch from specific branch
SELECT pggit.create_branch('hotfix', 'main');</code></pre>

            <h3 id="merge">pggit.merge(source_branch TEXT, message TEXT DEFAULT NULL)</h3>
            <p>Merge another branch into the current branch.</p>
            <pre><code>SELECT pggit.merge('feature/new-tables');

-- With custom message
SELECT pggit.merge('hotfix/urgent', 'Emergency fix for production');</code></pre>
            <p><strong>Important:</strong> Will fail if there are conflicts. Check the error message for details.</p>

            <h3 id="three_way_merge">pggit.three_way_merge(base UUID, source UUID, target UUID)</h3>
            <p>Analyze potential merge conflicts without actually merging.</p>
            <pre><code>SELECT * FROM pggit.three_way_merge(
    '123e4567-e89b-12d3-a456-426614174000',
    '223e4567-e89b-12d3-a456-426614174000',
    '323e4567-e89b-12d3-a456-426614174000'
);</code></pre>
        </section>

        <section>
            <h2>History & Inspection</h2>
            
            <h3 id="log">pggit.log(limit INTEGER DEFAULT 10)</h3>
            <p>View commit history for the current branch.</p>
            <pre><code>-- Last 10 commits
SELECT * FROM pggit.log();

-- Last 50 commits
SELECT * FROM pggit.log(50);</code></pre>

            <h3 id="diff">pggit.diff(from_commit UUID DEFAULT NULL, to_commit UUID DEFAULT NULL)</h3>
            <p>Show differences between commits or working directory.</p>
            <pre><code>-- Working directory vs HEAD
SELECT * FROM pggit.diff();

-- Between two commits
SELECT * FROM pggit.diff(
    '123e4567-e89b-12d3-a456-426614174000',
    '223e4567-e89b-12d3-a456-426614174000'
);</code></pre>

            <h3 id="stage_changes">pggit.stage_changes()</h3>
            <p>Preview what will be included in the next commit.</p>
            <pre><code>SELECT * FROM pggit.stage_changes();

-- Returns:
-- object_name | change_type | old_hash | new_hash</code></pre>
        </section>

        <section>
            <h2>Time Travel</h2>
            
            <h3 id="reset_hard">pggit.reset_hard(commit_id UUID)</h3>
            <p>Reset current branch to a specific commit and update schema.</p>
            <pre><code>SELECT pggit.reset_hard('123e4567-e89b-12d3-a456-426614174000');

-- WARNING: This changes your actual schema!</code></pre>

            <h3 id="revert_commit">pggit.revert_commit(commit_id UUID, message TEXT DEFAULT NULL)</h3>
            <p>Create a new commit that undoes a previous commit.</p>
            <pre><code>-- Find and revert a problematic commit
SELECT pggit.revert_commit(
    (SELECT commit_id FROM pggit.log() 
     WHERE message LIKE '%bad change%' LIMIT 1)
);</code></pre>

            <h3 id="show_revert_preview">pggit.show_revert_preview(commit_id UUID)</h3>
            <p>Preview what would happen if you reverted a commit.</p>
            <pre><code>SELECT * FROM pggit.show_revert_preview('123e4567-e89b-12d3-a456-426614174000');</code></pre>
        </section>

        <section>
            <h2>Utility Functions</h2>
            
            <h3 id="find_merge_base">pggit.find_merge_base(branch1 TEXT, branch2 TEXT)</h3>
            <p>Find the common ancestor of two branches.</p>
            <pre><code>SELECT pggit.find_merge_base('main', 'feature/big-change');</code></pre>

            <h3 id="get_table_ddl">pggit.get_table_ddl(schema_name TEXT, table_name TEXT)</h3>
            <p>Get the complete DDL for a table.</p>
            <pre><code>SELECT pggit.get_table_ddl('public', 'users');</code></pre>

            <h3 id="resolve_conflict">pggit.resolve_conflict(object_name TEXT, resolution TEXT)</h3>
            <p>Manually resolve a merge conflict.</p>
            <pre><code>-- Choose one side
SELECT pggit.resolve_conflict('public.users', 'ours');
SELECT pggit.resolve_conflict('public.orders', 'theirs');

-- Or provide custom DDL
SELECT pggit.resolve_conflict('public.products', 
    'CREATE TABLE products (id SERIAL PRIMARY KEY, ...)');</code></pre>
        </section>

        <section>
            <h2>Common Patterns</h2>
            
            <h3>Safe Feature Development</h3>
            <pre><code>-- 1. Create feature branch
SELECT pggit.checkout_b('feature/amazing');

-- 2. Make changes
CREATE TABLE ...;
ALTER TABLE ...;

-- 3. Commit regularly
SELECT pggit.commit('Work in progress');

-- 4. Merge main to stay updated
SELECT pggit.merge('main');

-- 5. When ready, merge back
SELECT pggit.checkout('main');
SELECT pggit.merge('feature/amazing');</code></pre>

            <h3>Emergency Rollback</h3>
            <pre><code>-- Option 1: Revert specific commit
SELECT * FROM pggit.log(20);  -- Find the bad commit
SELECT pggit.revert_commit('bad-commit-uuid');

-- Option 2: Reset to known good state
SELECT pggit.reset_hard('known-good-commit-uuid');</code></pre>

            <h3>Conflict Resolution</h3>
            <pre><code>-- 1. Attempt merge
SELECT pggit.merge('feature-branch');
-- ERROR: Merge conflicts detected

-- 2. Analyze conflicts
SELECT * FROM pggit.three_way_merge(...);

-- 3. Resolve each conflict
SELECT pggit.resolve_conflict('table1', 'ours');
SELECT pggit.resolve_conflict('table2', 'theirs');

-- 4. Complete merge
SELECT pggit.merge('feature-branch');</code></pre>
        </section>

        <section class="cta">
            <h2>Need Examples?</h2>
            <p>Check out real-world scenarios and use cases.</p>
            <p><a href="examples.html" class="btn btn-primary">View Examples</a></p>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 √âvolution digitale ‚Äî pgGit. Documentation as reliable as the code.</p>
        </div>
    </footer>
</body>
</html>