<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="pgGit Troubleshooting - Solutions to common problems">
    <title>Troubleshooting - pgGit</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='24' font-size='24'>üêò</text></svg>">
</head>
<body>
    <nav class="nav" role="navigation" aria-label="Main navigation">
        <div class="nav-inner">
            <a href="/" class="nav-logo">pgGit</a>
            <ul class="nav-links">
                <li><a href="getting-started.html">Getting Started</a></li>
                <li><a href="api.html">API Reference</a></li>
                <li><a href="examples.html">Examples</a></li>
                <li><a href="troubleshooting.html" aria-current="page">Troubleshooting</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <h1>pgGit Troubleshooting Guide</h1>
        
        <section>
            <p class="hero-subtitle">First, take a deep breath. We've all been there. These issues are common and fixable.</p>
        </section>

        <section>
            <h2>"ERROR: Extension 'pggit' is not available"</h2>
            <p><strong>What's happening:</strong> PostgreSQL can't find the extension files.</p>
            
            <h3>Solution:</h3>
            <pre><code>-- Check if the extension files are installed
SELECT * FROM pg_available_extensions WHERE name = 'pggit';

-- If not listed, you need to install the extension files:
-- 1. Download pggit
-- 2. Run: make install
-- 3. Restart PostgreSQL
-- 4. Try again: CREATE EXTENSION pggit;</code></pre>
            
            <p><strong>Still not working?</strong> Check that your PostgreSQL installation allows custom extensions and that you have the necessary permissions.</p>
        </section>

        <section>
            <h2>"ERROR: Merge conflicts detected: X conflicts"</h2>
            <p><strong>What's happening:</strong> Two branches changed the same objects in incompatible ways. This is normal!</p>
            
            <h3>Solution:</h3>
            <pre><code>-- 1. See what's conflicting
SELECT * FROM pggit.three_way_merge(
    (SELECT pggit.find_merge_base('source-branch', 'target-branch')),
    (SELECT target_commit_id FROM pggit.refs WHERE ref_name = 'source-branch'),
    (SELECT target_commit_id FROM pggit.refs WHERE ref_name = 'target-branch')
) WHERE conflict = true;

-- 2. For each conflict, decide how to resolve
SELECT pggit.resolve_conflict('schema.table_name', 'ours');  -- Keep current branch version
-- OR
SELECT pggit.resolve_conflict('schema.table_name', 'theirs'); -- Take incoming branch version
-- OR
SELECT pggit.resolve_conflict('schema.table_name', 'CREATE TABLE ...'); -- Custom resolution

-- 3. Retry the merge
SELECT pggit.merge('source-branch');</code></pre>
        </section>

        <section>
            <h2>"ERROR: No changes to commit"</h2>
            <p><strong>What's happening:</strong> You tried to commit but nothing has changed since the last commit.</p>
            
            <h3>Solution:</h3>
            <pre><code>-- Check what pggit sees
SELECT * FROM pggit.stage_changes();

-- If empty, you either:
-- 1. Already committed your changes (check the log)
SELECT * FROM pggit.log(5);

-- 2. Made changes pggit doesn't track (like data changes)
-- 3. Made changes in a different schema

-- Remember: pggit only tracks DDL (structure) changes, not DML (data) changes</code></pre>
        </section>

        <section>
            <h2>"ERROR: Branch 'X' not found"</h2>
            <p><strong>What's happening:</strong> You're trying to checkout or merge a branch that doesn't exist.</p>
            
            <h3>Solution:</h3>
            <pre><code>-- List all branches
SELECT * FROM pggit.refs WHERE ref_type = 'branch';

-- Check your current branch
SELECT * FROM pggit.status();

-- Common mistake: typo in branch name
-- If you meant to create a new branch:
SELECT pggit.checkout_b('branch-name');

-- If merging from remote (not supported yet)
-- pggit only tracks local branches currently</code></pre>
        </section>

        <section>
            <h2>"My schema changes disappeared!"</h2>
            <p><strong>What's happening:</strong> You switched branches and your changes seem gone. Don't panic!</p>
            
            <h3>Solution:</h3>
            <pre><code>-- Your changes are safe in the branch you were on
-- 1. Check which branch has your changes
SELECT ref_name, c.message, c.committed_at 
FROM pggit.refs r
JOIN pggit.commits c ON r.target_commit_id = c.id
WHERE c.message LIKE '%your change description%';

-- 2. Switch back to that branch
SELECT pggit.checkout('your-feature-branch');

-- 3. Verify your changes are back
\d+ your_table_name</code></pre>
            
            <p><strong>Pro tip:</strong> This is actually pgGit working correctly! Each branch has its own schema state.</p>
        </section>

        <section>
            <h2>"Performance is slow with large schemas"</h2>
            <p><strong>What's happening:</strong> pgGit needs to track many objects and compute hashes.</p>
            
            <h3>Solution:</h3>
            <pre><code>-- 1. Check how many objects you're tracking
SELECT COUNT(*) FROM information_schema.tables 
WHERE table_schema NOT IN ('pg_catalog', 'information_schema', 'gitversion');

-- 2. For large schemas (>500 objects), consider:
-- - Committing less frequently
-- - Using more targeted branches
-- - Excluding certain schemas from tracking

-- 3. Check for missing indexes
SELECT pggit.verify_performance_indexes();</code></pre>
        </section>

        <section>
            <h2>"ERROR: Cannot revert initial commit"</h2>
            <p><strong>What's happening:</strong> You're trying to revert the very first commit, which would leave no schema.</p>
            
            <h3>Solution:</h3>
            <pre><code>-- Instead of reverting, create a new branch from before your changes
SELECT pggit.checkout_b('fresh-start');

-- Then manually drop what you need
DROP TABLE IF EXISTS unwanted_table CASCADE;

-- And commit the clean state
SELECT pggit.commit('Remove unwanted objects');</code></pre>
        </section>

        <section>
            <h2>Common Mistakes to Avoid</h2>
            
            <h3>1. Forgetting to commit before switching branches</h3>
            <pre><code>-- Always check for uncommitted changes
SELECT * FROM pggit.stage_changes();

-- Commit if needed
SELECT pggit.commit('WIP: Save work before switching');</code></pre>

            <h3>2. Working directly on main</h3>
            <pre><code>-- Always create a feature branch
SELECT pggit.checkout_b('feature/my-changes');

-- Work here, then merge when ready</code></pre>

            <h3>3. Not syncing with main regularly</h3>
            <pre><code>-- On your feature branch, regularly:
SELECT pggit.merge('main');

-- This prevents massive conflicts later</code></pre>
        </section>

        <section>
            <h2>Emergency Recovery</h2>
            <p>If everything has gone wrong:</p>
            
            <pre><code>-- 1. Don't panic
-- 2. Check your current state
SELECT * FROM pggit.status();
SELECT * FROM pggit.log(20);

-- 3. Find a known good commit
SELECT commit_id, message, committed_at 
FROM pggit.log(50)
WHERE committed_at < 'when things went wrong'
ORDER BY committed_at DESC;

-- 4. Reset to that commit
SELECT pggit.reset_hard('known-good-commit-id');

-- 5. Create a new branch to try again
SELECT pggit.checkout_b('recovery-attempt');</code></pre>
        </section>

        <section>
            <h2>Still Stuck?</h2>
            <p>If you're still having issues:</p>
            <ol>
                <li>Check our <a href="https://github.com/evoludigit/pggit/issues">GitHub issues</a> - someone might have had the same problem</li>
                <li>Include the output of <code>SELECT * FROM pggit.status();</code> in your report</li>
                <li>Remember: pgGit is still in early development. Your feedback helps make it better!</li>
            </ol>
        </section>

        <section class="cta">
            <h2>Want to Know More?</h2>
            <p>Check out our examples to see pggit in action.</p>
            <p><a href="examples.html" class="btn btn-primary">View Examples</a></p>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 √âvolution digitale ‚Äî pgGit. We've all been there. You'll get through this.</p>
        </div>
    </footer>
</body>
</html>