warning: The `tool.uv.dev-dependencies` field (used in `pyproject.toml`) is deprecated and will be removed in a future release; use `dependency-groups.dev` instead
============================= test session starts ==============================
platform linux -- Python 3.13.7, pytest-9.0.2, pluggy-1.6.0
rootdir: /home/lionel/code/pggit
configfile: pyproject.toml
plugins: timeout-2.4.0, hypothesis-6.148.7, xdist-3.8.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 63 items

tests/chaos/test_concurrent_branching.py FFFF.FFFFF                      [ 15%]
tests/chaos/test_concurrent_commits.py FFFFE.FFFE                        [ 31%]
tests/chaos/test_concurrent_versioning.py .FFFssssF                      [ 46%]
tests/chaos/test_deadlock_scenarios.py .FF.F.                            [ 55%]
tests/chaos/test_property_based_core.py FFFFFFFF                         [ 68%]
tests/chaos/test_property_based_data.py FFFFFF                           [ 77%]
tests/chaos/test_property_based_migrations.py FFFFFF                     [ 87%]
tests/chaos/test_serialization_failures.py ...FF.FF                      [100%]

==================================== ERRORS ====================================
_ ERROR at setup of TestConcurrentCommits.test_concurrent_commits_with_delays __
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_concurrent_commits_with_delays' requested an async fixture 'async_conn', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
____ ERROR at setup of TestConcurrentCommits.test_async_concurrent_commits _____
.venv/lib/python3.13/site-packages/pytest_asyncio/plugin.py:728: in pytest_fixture_setup
    return (yield)
            ^^^^^
E   pytest.PytestRemovedIn9Warning: 'test_async_concurrent_commits' requested an async fixture 'async_conn_pool', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
E   See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
=================================== FAILURES ===================================
__________ TestConcurrentBranching.test_concurrent_branch_creation[5] __________
tests/chaos/test_concurrent_branching.py:67: in test_concurrent_branch_creation
    assert len(successes) == num_branches, (
E   AssertionError: All 5 branches should be created, but 5 failed
E   assert 0 == 5
E    +  where 0 = len([])
_________ TestConcurrentBranching.test_concurrent_branch_creation[10] __________
tests/chaos/test_concurrent_branching.py:67: in test_concurrent_branch_creation
    assert len(successes) == num_branches, (
E   AssertionError: All 10 branches should be created, but 10 failed
E   assert 0 == 10
E    +  where 0 = len([])
_________ TestConcurrentBranching.test_concurrent_branch_creation[20] __________
tests/chaos/test_concurrent_branching.py:67: in test_concurrent_branch_creation
    assert len(successes) == num_branches, (
E   AssertionError: All 20 branches should be created, but 20 failed
E   assert 0 == 20
E    +  where 0 = len([])
______ TestConcurrentBranching.test_concurrent_branch_creation_same_name _______
tests/chaos/test_concurrent_branching.py:133: in test_concurrent_branch_creation_same_name
    assert any(
E   AssertionError: Unexpected failure reason: function pggit.commit_changes(unknown, unknown, unknown) does not exist
E     LINE 1: SELECT pggit.commit_changes($1, $2, $3)
E                    ^
E     HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
E   assert False
E    +  where False = any(<generator object TestConcurrentBranching.test_concurrent_branch_creation_same_name.<locals>.<genexpr> at 0x7f444fc66e90>)
______ TestConcurrentBranching.test_concurrent_branch_operations_mixed[3] ______
tests/chaos/test_concurrent_branching.py:317: in test_concurrent_branch_operations_mixed
    assert success_rate > 0.5, f"Expected >50% success rate, got {success_rate:.2f}"
E   AssertionError: Expected >50% success rate, got 0.00
E   assert 0.0 > 0.5
______ TestConcurrentBranching.test_concurrent_branch_operations_mixed[6] ______
tests/chaos/test_concurrent_branching.py:317: in test_concurrent_branch_operations_mixed
    assert success_rate > 0.5, f"Expected >50% success rate, got {success_rate:.2f}"
E   AssertionError: Expected >50% success rate, got 0.00
E   assert 0.0 > 0.5
______ TestConcurrentBranching.test_concurrent_branch_operations_mixed[9] ______
tests/chaos/test_concurrent_branching.py:317: in test_concurrent_branch_operations_mixed
    assert success_rate > 0.5, f"Expected >50% success rate, got {success_rate:.2f}"
E   AssertionError: Expected >50% success rate, got 0.00
E   assert 0.0 > 0.5
________ TestConcurrentBranching.test_branch_isolation_between_workers _________
tests/chaos/test_concurrent_branching.py:404: in test_branch_isolation_between_workers
    assert len(successes) == num_workers, (
E   AssertionError: All 6 isolated workers should succeed, got 6 failures
E   assert 0 == 6
E    +  where 0 = len([])
__________ TestConcurrentBranching.test_branch_contention_under_load ___________
tests/chaos/test_concurrent_branching.py:498: in test_branch_contention_under_load
    assert total_operations > 0, "Some operations should complete under load"
E   AssertionError: Some operations should complete under load
E   assert 0 > 0
_________ TestConcurrentCommits.test_concurrent_commits_same_branch[2] _________
tests/chaos/test_concurrent_commits.py:100: in test_concurrent_commits_same_branch
    assert len(results) > 0, (
E   AssertionError: At least one commit should succeed, but got 2 errors
E   assert 0 > 0
E    +  where 0 = len([])
_________ TestConcurrentCommits.test_concurrent_commits_same_branch[5] _________
tests/chaos/test_concurrent_commits.py:100: in test_concurrent_commits_same_branch
    assert len(results) > 0, (
E   AssertionError: At least one commit should succeed, but got 5 errors
E   assert 0 > 0
E    +  where 0 = len([])
________ TestConcurrentCommits.test_concurrent_commits_same_branch[10] _________
tests/chaos/test_concurrent_commits.py:100: in test_concurrent_commits_same_branch
    assert len(results) > 0, (
E   AssertionError: At least one commit should succeed, but got 10 errors
E   assert 0 > 0
E    +  where 0 = len([])
________ TestConcurrentCommits.test_concurrent_commits_same_branch[20] _________
tests/chaos/test_concurrent_commits.py:100: in test_concurrent_commits_same_branch
    assert len(results) > 0, (
E   AssertionError: At least one commit should succeed, but got 20 errors
E   assert 0 > 0
E    +  where 0 = len([])
_ TestConcurrentCommits.test_concurrent_commits_different_isolation_levels[READ COMMITTED] _
tests/chaos/test_concurrent_commits.py:312: in test_concurrent_commits_different_isolation_levels
    assert len(successes) > 0, f"No commits succeeded with {isolation_level}"
E   AssertionError: No commits succeeded with READ COMMITTED
E   assert 0 > 0
E    +  where 0 = len([])
_ TestConcurrentCommits.test_concurrent_commits_different_isolation_levels[REPEATABLE READ] _
tests/chaos/test_concurrent_commits.py:312: in test_concurrent_commits_different_isolation_levels
    assert len(successes) > 0, f"No commits succeeded with {isolation_level}"
E   AssertionError: No commits succeeded with REPEATABLE READ
E   assert 0 > 0
E    +  where 0 = len([])
_ TestConcurrentCommits.test_concurrent_commits_different_isolation_levels[SERIALIZABLE] _
tests/chaos/test_concurrent_commits.py:312: in test_concurrent_commits_different_isolation_levels
    assert len(successes) > 0, f"No commits succeeded with {isolation_level}"
E   AssertionError: No commits succeeded with SERIALIZABLE
E   assert 0 > 0
E    +  where 0 = len([])
_______ TestConcurrentVersioning.test_concurrent_version_increments[10] ________
tests/chaos/test_concurrent_versioning.py:32: in test_concurrent_version_increments
    setup_conn.execute(f"CREATE TABLE {table_name} (id INT)")
.venv/lib/python3.13/site-packages/psycopg/connection.py:299: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.DuplicateTable: relation "version_test_table" already exists
_______ TestConcurrentVersioning.test_concurrent_version_increments[20] ________
tests/chaos/test_concurrent_versioning.py:32: in test_concurrent_version_increments
    setup_conn.execute(f"CREATE TABLE {table_name} (id INT)")
.venv/lib/python3.13/site-packages/psycopg/connection.py:299: in execute
    raise ex.with_traceback(None)
E   psycopg.errors.DuplicateTable: relation "version_test_table" already exists
_____ TestConcurrentVersioning.test_version_read_consistency_during_writes _____
tests/chaos/test_concurrent_versioning.py:183: in test_version_read_consistency_during_writes
    assert len(all_versions) > 0, "Should have read some versions"
E   AssertionError: Should have read some versions
E   assert 0 > 0
E    +  where 0 = len([])
________ TestConcurrentVersioning.test_high_contention_version_updates _________
tests/chaos/test_concurrent_versioning.py:447: in test_high_contention_version_updates
    assert len(valid_versions) > 0, (
E   AssertionError: No successful version reads under high contention
E   assert 0 > 0
E    +  where 0 = len([])
__________ TestDeadlockScenarios.test_deadlock_with_pggit_operations ___________
tests/chaos/test_deadlock_scenarios.py:203: in test_deadlock_with_pggit_operations
    pytest.fail(
E   Failed: Unexpected deadlock scenario - neither success nor proper deadlock detection
______________ TestDeadlockScenarios.test_multiple_table_deadlock ______________
tests/chaos/test_deadlock_scenarios.py:273: in test_multiple_table_deadlock
    assert total_resolved == 3, (
E   AssertionError: All operations should either succeed or detect deadlock: 0 success, 2 deadlocks
E   assert 2 == 3
_________ TestDeadlockScenarios.test_deadlock_recovery_data_integrity __________
tests/chaos/test_deadlock_scenarios.py:485: in test_deadlock_recovery_data_integrity
    assert final_data == initial_data, (
E   AssertionError: Data integrity violated by deadlock: expected 'initial', got 'modified_by_1'
E   assert 'modified_by_1' == 'initial'
E     
E     - initial
E     + modified_by_1
_____ TestTableVersioningProperties.test_create_table_always_gets_version ______
  + Exception Group Traceback (most recent call last):
  |   File "/home/lionel/code/pggit/tests/chaos/test_property_based_core.py", line 28, in test_create_table_always_gets_version
  |     @settings(
  |     
  |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 2234, in wrapped_test
  |     raise the_error_hypothesis_found
  | ExceptionGroup: Hypothesis found 2 distinct failures. (2 sub-exceptions)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/home/lionel/code/pggit/tests/chaos/test_property_based_core.py", line 38, in test_create_table_always_gets_version
    |     sync_conn.execute(tbl_def["create_sql"])
    |     ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/psycopg/connection.py", line 299, in execute
    |     raise ex.with_traceback(None)
    | psycopg.errors.DatatypeMismatch: column "y" is of type integer but default expression is of type timestamp with time zone
    | HINT:  You will need to rewrite or cast the expression.
    | Falsifying example: test_create_table_always_gets_version(
    |     self=<chaos.test_property_based_core.TestTableVersioningProperties object at 0x7f444fe6f250>,
    |     sync_conn=<psycopg.Connection [IDLE] (host=localhost user=postgres database=pggit_chaos_test) at 0x7f444fc614f0>,
    |     tbl_def={'name': 'o',
    |      'columns': ['wejnub SERIAL PRIMARY KEY',
    |       'k SERIAL NOT NULL',
    |       'f01 NUMERIC(10,2) UNIQUE',
    |       'ykupw5t BIGINT NOT NULL',
    |       'y INTEGER DEFAULT CURRENT_TIMESTAMP',
    |       'mdiv TEXT DEFAULT 0',
    |       'gv_95k_9a BOOLEAN UNIQUE',
    |       'f01wepkup TIMESTAMP',
    |       'dm BOOLEAN DEFAULT CURRENT_TIMESTAMP'],
    |      'create_sql': 'CREATE TABLE o (wejnub SERIAL PRIMARY KEY, k SERIAL NOT NULL, f01 NUMERIC(10,2) UNIQUE, ykupw5t BIGINT NOT NULL, y INTEGER DEFAULT CURRENT_TIMESTAMP, mdiv TEXT DEFAULT 0, gv_95k_9a BOOLEAN UNIQUE, f01wepkup TIMESTAMP, dm BOOLEAN DEFAULT CURRENT_TIMESTAMP)'},
    | )
    +---------------- 2 ----------------
    | Traceback (most recent call last):
    |   File "/home/lionel/code/pggit/tests/chaos/test_property_based_core.py", line 38, in test_create_table_always_gets_version
    |     sync_conn.execute(tbl_def["create_sql"])
    |     ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/psycopg/connection.py", line 299, in execute
    |     raise ex.with_traceback(None)
    | psycopg.errors.DuplicateTable: relation "a" already exists
    | Falsifying example: test_create_table_always_gets_version(
    |     self=<chaos.test_property_based_core.TestTableVersioningProperties object at 0x7f444fe6f250>,
    |     sync_conn=<psycopg.Connection [IDLE] (host=localhost user=postgres database=pggit_chaos_test) at 0x7f444fc614f0>,
    |     tbl_def={'name': 'a',
    |      'columns': ['a INTEGER'],
    |      'create_sql': 'CREATE TABLE a (a INTEGER)'},
    | )
    +------------------------------------
_____ TestTableVersioningProperties.test_trinity_id_unique_across_branches _____
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_core.py::TestTableVersioningProperties::test_trinity_id_unique_across_branches' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
_________ TestTableVersioningProperties.test_commit_message_preserved __________
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_core.py::TestTableVersioningProperties::test_commit_message_preserved' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
________ TestVersionIncrementProperties.test_patch_increment_properties ________
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_core.py::TestVersionIncrementProperties::test_patch_increment_properties' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
_______ TestVersionIncrementProperties.test_minor_increment_resets_patch _______
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_core.py::TestVersionIncrementProperties::test_minor_increment_resets_patch' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
__ TestVersionIncrementProperties.test_major_increment_resets_minor_and_patch __
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_core.py::TestVersionIncrementProperties::test_major_increment_resets_minor_and_patch' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
_________ TestBranchNamingProperties.test_valid_branch_names_accepted __________
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_core.py::TestBranchNamingProperties::test_valid_branch_names_accepted' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
______ TestIdentifierValidationProperties.test_valid_identifiers_accepted ______
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_core.py::TestIdentifierValidationProperties::test_valid_identifiers_accepted' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
__________ TestDataBranchingProperties.test_branched_data_independent __________
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_data.py::TestDataBranchingProperties::test_branched_data_independent' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
_____ TestDataBranchingProperties.test_data_branch_creation_preserves_data _____
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_data.py::TestDataBranchingProperties::test_data_branch_creation_preserves_data' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
________ TestDataIntegrityProperties.test_data_integrity_across_commits ________
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_data.py::TestDataIntegrityProperties::test_data_integrity_across_commits' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
____ TestDataIntegrityProperties.test_schema_changes_preserve_existing_data ____
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_data.py::TestDataIntegrityProperties::test_schema_changes_preserve_existing_data' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
___ TestConcurrentDataOperations.test_concurrent_data_modifications_isolated ___
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_data.py::TestConcurrentDataOperations::test_concurrent_data_modifications_isolated' uses a function-scoped fixture 'conn_pool'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
_______ TestDataVersioningProperties.test_data_version_history_preserved _______
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_data.py::TestDataVersioningProperties::test_data_version_history_preserved' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
_________ TestMigrationIdempotency.test_apply_migration_twice_is_safe __________
  + Exception Group Traceback (most recent call last):
  |   File "/home/lionel/code/pggit/tests/chaos/test_property_based_migrations.py", line 21, in test_apply_migration_twice_is_safe
  |     @settings(
  |     
  |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 2234, in wrapped_test
  |     raise the_error_hypothesis_found
  | hypothesis.errors.FlakyFailure: Inconsistent results from replaying a test case!
  |   last: INTERESTING from KeyError at /home/lionel/code/pggit/tests/chaos/test_property_based_migrations.py:51
  |   this: INTERESTING from DuplicateTable at /home/lionel/code/pggit/.venv/lib/python3.13/site-packages/psycopg/connection.py:299 (3 sub-exceptions)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 1200, in _execute_once_for_engine
    |     result = self.execute_once(data)
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 1140, in execute_once
    |     result = self.test_runner(data, run)
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 824, in default_executor
    |     return function(data)
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 1097, in run
    |     return test(*args, **kwargs)
    |   File "/home/lionel/code/pggit/tests/chaos/test_property_based_migrations.py", line 21, in test_apply_migration_twice_is_safe
    |     @settings(
    |     
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 994, in test
    |     return self.test(*args, **kwargs)
    |            ~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/home/lionel/code/pggit/tests/chaos/test_property_based_migrations.py", line 51, in test_apply_migration_twice_is_safe
    |     count1 = cursor1.fetchone()[0]
    |              ~~~~~~~~~~~~~~~~~~^^^
    | KeyError: 0
    +---------------- 2 ----------------
    | Traceback (most recent call last):
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 1200, in _execute_once_for_engine
    |     result = self.execute_once(data)
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 1140, in execute_once
    |     result = self.test_runner(data, run)
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 824, in default_executor
    |     return function(data)
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 1097, in run
    |     return test(*args, **kwargs)
    |   File "/home/lionel/code/pggit/tests/chaos/test_property_based_migrations.py", line 21, in test_apply_migration_twice_is_safe
    |     @settings(
    |     
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 994, in test
    |     return self.test(*args, **kwargs)
    |            ~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/home/lionel/code/pggit/tests/chaos/test_property_based_migrations.py", line 31, in test_apply_migration_twice_is_safe
    |     sync_conn.execute(tbl_def["create_sql"])
    |     ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/psycopg/connection.py", line 299, in execute
    |     raise ex.with_traceback(None)
    | psycopg.errors.DuplicateTable: relation "a" already exists
    +---------------- 3 ----------------
    | Traceback (most recent call last):
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 1200, in _execute_once_for_engine
    |     result = self.execute_once(data)
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 1140, in execute_once
    |     result = self.test_runner(data, run)
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 824, in default_executor
    |     return function(data)
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 1097, in run
    |     return test(*args, **kwargs)
    |   File "/home/lionel/code/pggit/tests/chaos/test_property_based_migrations.py", line 21, in test_apply_migration_twice_is_safe
    |     @settings(
    |     
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/hypothesis/core.py", line 994, in test
    |     return self.test(*args, **kwargs)
    |            ~~~~~~~~~^^^^^^^^^^^^^^^^^
    |   File "/home/lionel/code/pggit/tests/chaos/test_property_based_migrations.py", line 31, in test_apply_migration_twice_is_safe
    |     sync_conn.execute(tbl_def["create_sql"])
    |     ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/lionel/code/pggit/.venv/lib/python3.13/site-packages/psycopg/connection.py", line 299, in execute
    |     raise ex.with_traceback(None)
    | psycopg.errors.DuplicateTable: relation "gl4b" already exists
    +------------------------------------
______ TestMigrationIdempotency.test_schema_hash_changes_on_modification _______
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_migrations.py::TestMigrationIdempotency::test_schema_hash_changes_on_modification' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
_____ TestMigrationIdempotency.test_schema_hash_consistent_for_same_schema _____
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_migrations.py::TestMigrationIdempotency::test_schema_hash_consistent_for_same_schema' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
____ TestMigrationRollbackProperties.test_rollback_restores_original_state _____
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_migrations.py::TestMigrationRollbackProperties::test_rollback_restores_original_state' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
_______ TestMigrationValidationProperties.test_migration_sql_validation ________
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_migrations.py::TestMigrationValidationProperties::test_migration_sql_validation' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
___ TestSchemaEvolutionProperties.test_schema_evolution_maintains_integrity ____
E   hypothesis.errors.FailedHealthCheck: 'tests/chaos/test_property_based_migrations.py::TestSchemaEvolutionProperties::test_schema_evolution_maintains_integrity' uses a function-scoped fixture 'sync_conn'.
    
    Function-scoped fixtures are not reset between inputs generated by `@given(...)`, which is often surprising and can cause subtle test bugs.
    
    If you were expecting the fixture to run separately for each generated input, then unfortunately you will need to find a different way to achieve your goal (for example, replacing the fixture with a similar context manager inside of the test).
    
    If you are confident that your test will work correctly even though the fixture is not reset between generated inputs, you can suppress this health check with @settings(suppress_health_check=[HealthCheck.function_scoped_fixture]). See https://hypothesis.readthedocs.io/en/latest/reference/api.html#hypothesis.HealthCheck for details.
All traceback entries are hidden. Pass `--full-trace` to see hidden and internal frames.
__ TestSerializationFailures.test_isolation_levels_behavior[REPEATABLE READ] ___
tests/chaos/test_serialization_failures.py:254: in test_isolation_levels_behavior
    assert total_resolved == num_workers, (
E   AssertionError: All operations should complete: 1/10
E   assert 1 == 10
____ TestSerializationFailures.test_isolation_levels_behavior[SERIALIZABLE] ____
tests/chaos/test_serialization_failures.py:248: in test_isolation_levels_behavior
    assert len(serialization_errors) > 0, (
E   AssertionError: SERIALIZABLE should produce serialization errors, got 0
E   assert 0 > 0
E    +  where 0 = len([])
_____ TestSerializationFailures.test_pggit_commit_serialization_conflicts ______
tests/chaos/test_serialization_failures.py:416: in test_pggit_commit_serialization_conflicts
    assert len(serialization_errors) > 0, (
E   AssertionError: SERIALIZABLE isolation should produce serialization conflicts
E   assert 0 > 0
E    +  where 0 = len([])
____ TestSerializationFailures.test_long_running_serializable_transactions _____
tests/chaos/test_serialization_failures.py:510: in test_long_running_serializable_transactions
    assert total_resolved == num_workers, (
E   AssertionError: All transactions should complete: 1/3
E   assert 1 == 3
=========================== short test summary info ============================
SKIPPED [3] tests/chaos/test_concurrent_versioning.py:223: Version tracking not implemented yet
SKIPPED [1] tests/chaos/test_concurrent_versioning.py:333: Version tracking not implemented yet
ERROR tests/chaos/test_concurrent_commits.py::TestConcurrentCommits::test_concurrent_commits_with_delays
ERROR tests/chaos/test_concurrent_commits.py::TestConcurrentCommits::test_async_concurrent_commits
FAILED tests/chaos/test_concurrent_branching.py::TestConcurrentBranching::test_concurrent_branch_creation[5]
FAILED tests/chaos/test_concurrent_branching.py::TestConcurrentBranching::test_concurrent_branch_creation[10]
FAILED tests/chaos/test_concurrent_branching.py::TestConcurrentBranching::test_concurrent_branch_creation[20]
FAILED tests/chaos/test_concurrent_branching.py::TestConcurrentBranching::test_concurrent_branch_creation_same_name
FAILED tests/chaos/test_concurrent_branching.py::TestConcurrentBranching::test_concurrent_branch_operations_mixed[3]
FAILED tests/chaos/test_concurrent_branching.py::TestConcurrentBranching::test_concurrent_branch_operations_mixed[6]
FAILED tests/chaos/test_concurrent_branching.py::TestConcurrentBranching::test_concurrent_branch_operations_mixed[9]
FAILED tests/chaos/test_concurrent_branching.py::TestConcurrentBranching::test_branch_isolation_between_workers
FAILED tests/chaos/test_concurrent_branching.py::TestConcurrentBranching::test_branch_contention_under_load
FAILED tests/chaos/test_concurrent_commits.py::TestConcurrentCommits::test_concurrent_commits_same_branch[2]
FAILED tests/chaos/test_concurrent_commits.py::TestConcurrentCommits::test_concurrent_commits_same_branch[5]
FAILED tests/chaos/test_concurrent_commits.py::TestConcurrentCommits::test_concurrent_commits_same_branch[10]
FAILED tests/chaos/test_concurrent_commits.py::TestConcurrentCommits::test_concurrent_commits_same_branch[20]
FAILED tests/chaos/test_concurrent_commits.py::TestConcurrentCommits::test_concurrent_commits_different_isolation_levels[READ COMMITTED]
FAILED tests/chaos/test_concurrent_commits.py::TestConcurrentCommits::test_concurrent_commits_different_isolation_levels[REPEATABLE READ]
FAILED tests/chaos/test_concurrent_commits.py::TestConcurrentCommits::test_concurrent_commits_different_isolation_levels[SERIALIZABLE]
FAILED tests/chaos/test_concurrent_versioning.py::TestConcurrentVersioning::test_concurrent_version_increments[10]
FAILED tests/chaos/test_concurrent_versioning.py::TestConcurrentVersioning::test_concurrent_version_increments[20]
FAILED tests/chaos/test_concurrent_versioning.py::TestConcurrentVersioning::test_version_read_consistency_during_writes
FAILED tests/chaos/test_concurrent_versioning.py::TestConcurrentVersioning::test_high_contention_version_updates
FAILED tests/chaos/test_deadlock_scenarios.py::TestDeadlockScenarios::test_deadlock_with_pggit_operations
FAILED tests/chaos/test_deadlock_scenarios.py::TestDeadlockScenarios::test_multiple_table_deadlock
FAILED tests/chaos/test_deadlock_scenarios.py::TestDeadlockScenarios::test_deadlock_recovery_data_integrity
FAILED tests/chaos/test_property_based_core.py::TestTableVersioningProperties::test_create_table_always_gets_version
FAILED tests/chaos/test_property_based_core.py::TestTableVersioningProperties::test_trinity_id_unique_across_branches
FAILED tests/chaos/test_property_based_core.py::TestTableVersioningProperties::test_commit_message_preserved
FAILED tests/chaos/test_property_based_core.py::TestVersionIncrementProperties::test_patch_increment_properties
FAILED tests/chaos/test_property_based_core.py::TestVersionIncrementProperties::test_minor_increment_resets_patch
FAILED tests/chaos/test_property_based_core.py::TestVersionIncrementProperties::test_major_increment_resets_minor_and_patch
FAILED tests/chaos/test_property_based_core.py::TestBranchNamingProperties::test_valid_branch_names_accepted
FAILED tests/chaos/test_property_based_core.py::TestIdentifierValidationProperties::test_valid_identifiers_accepted
FAILED tests/chaos/test_property_based_data.py::TestDataBranchingProperties::test_branched_data_independent
FAILED tests/chaos/test_property_based_data.py::TestDataBranchingProperties::test_data_branch_creation_preserves_data
FAILED tests/chaos/test_property_based_data.py::TestDataIntegrityProperties::test_data_integrity_across_commits
FAILED tests/chaos/test_property_based_data.py::TestDataIntegrityProperties::test_schema_changes_preserve_existing_data
FAILED tests/chaos/test_property_based_data.py::TestConcurrentDataOperations::test_concurrent_data_modifications_isolated
FAILED tests/chaos/test_property_based_data.py::TestDataVersioningProperties::test_data_version_history_preserved
FAILED tests/chaos/test_property_based_migrations.py::TestMigrationIdempotency::test_apply_migration_twice_is_safe
FAILED tests/chaos/test_property_based_migrations.py::TestMigrationIdempotency::test_schema_hash_changes_on_modification
FAILED tests/chaos/test_property_based_migrations.py::TestMigrationIdempotency::test_schema_hash_consistent_for_same_schema
FAILED tests/chaos/test_property_based_migrations.py::TestMigrationRollbackProperties::test_rollback_restores_original_state
FAILED tests/chaos/test_property_based_migrations.py::TestMigrationValidationProperties::test_migration_sql_validation
FAILED tests/chaos/test_property_based_migrations.py::TestSchemaEvolutionProperties::test_schema_evolution_maintains_integrity
FAILED tests/chaos/test_serialization_failures.py::TestSerializationFailures::test_isolation_levels_behavior[REPEATABLE READ]
FAILED tests/chaos/test_serialization_failures.py::TestSerializationFailures::test_isolation_levels_behavior[SERIALIZABLE]
FAILED tests/chaos/test_serialization_failures.py::TestSerializationFailures::test_pggit_commit_serialization_conflicts
FAILED tests/chaos/test_serialization_failures.py::TestSerializationFailures::test_long_running_serializable_transactions
============= 47 failed, 10 passed, 4 skipped, 2 errors in 18.56s ==============
